{"version":3,"sources":["chatroom.js"],"names":["vm","routeMapping","index","setUserData","firebaseConfig","apiKey","authDomain","firebase","initializeApp","database","app","Vue","$","EmojiPicker","el","data","currentRoute","inValid","isMaskOpen","isMenuOpen","maskTitle","controlTransition","leave","username","userData","usergender","getUsername","inputStatus","getUsergender","setUsernameDialogs","target","chatRoomDialogs","roomList","newRoomData","name","description","currentRoomData","chatData","search","input","imageUrl","filters","formatTime","timeStamp","Date","getHours","toString","padStart","getMinutes","watch","val","_this","this","chatRoom","$refs","chatRoomList","scrollTo","scrollHeight","setTimeout","methods","initialUserData","userdate","getUserdate","validateAndGoRoute","routeNum","changeTransition","enter","submitUserData","type","_this2","push","text","roomLobby","showRoomCommentAmount","room","Object","keys","length","goChatRoom","roomId","id","listenRoomData","createNewRoom","isAble","key","_this3","roomData","getTime","appendEmoji","emoji","addChat","_this4","writeRoomData","_this5","ref","snapshot","writeRoomsData","set","listenRoomsData","roomRef","_this6","created"],"mappings":"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","file":"chatroom.js","sourcesContent":["let vm = null;\nconst routeMapping = {\n  index: 1,\n  setUserData: 2,\n  roomLobby: 3,\n  chatRoom: 4,\n};\n// Firebase configuration\nconst firebaseConfig = {\n  apiKey: \"AIzaSyA4P_r_EK-DXuXETYaSsVybrChSCI25FFs\",\n  authDomain: \"chatroom-52faa.firebaseapp.com\",\n  databaseURL: \"https://chatroom-52faa.firebaseio.com\",\n};\n// Initialize Firebase\nfirebase.initializeApp(firebaseConfig);\nconst database = firebase.app().database();\n\nVue.use(EmojiPicker);\n$(function () {\n  vm = new Vue({\n    el: \"#app\",\n    data: {\n      currentRoute: routeMapping.index,\n      inValid: false,\n      isMaskOpen: false,\n      isMenuOpen: false,\n      maskTitle: null,\n      controlTransition: {\n        enter: '',\n        leave: ''\n      },\n      userData: {\n        username: null,\n        userdate: null,\n        usergender: null,\n      },\n      inputStatus: {\n        getUsername: true,\n        getUserdate: false,\n        getUsergender: false,\n      },\n      setUsernameDialogs: [\n        {\n          target: 'robot',\n          text: '歡迎你使用我們的匿名聊天室，該怎麼稱呼你呢?'\n        }\n      ],\n      chatRoomDialogs: {},\n      roomList: [],\n      newRoomData: {\n        name: null,\n        description: null,\n      },\n      currentRoomData: {},\n      chatData: {\n        search: '',\n        input: '',\n        imageUrl: '',\n      },\n    },\n    filters: {\n      formatTime(timeStamp) {\n        const hours = new Date(timeStamp).getHours().toString().padStart(2, 0);\n        const minutes = new Date(timeStamp).getMinutes().toString().padStart(2, 0);\n        return `${hours} : ${minutes}`;\n      },\n    },\n    watch: {\n      currentRoute(val) {\n        if (val === routeMapping.chatRoom) {\n          this.chatData = {\n            search: '',\n            input: '',\n            imageUrl: '',\n          };\n          setTimeout(() => {\n            this.$refs.chatRoomList.scrollTo(0, this.$refs.chatRoomList.scrollHeight + 500);\n          }, 1000);\n        }\n      }\n    },\n    methods: {\n      initialUserData() {\n        this.userData = {\n          username: null,\n          userdate: null,\n          usergender: null,\n        };\n        this.inputStatus = {\n          getUsername: true,\n          getUserdate: false,\n          getUsergender: false,\n        };\n        this.setUsernameDialogs = [\n          {\n            target: 'robot',\n            text: '歡迎你使用我們的匿名聊天室，該怎麼稱呼你呢?'\n          }\n        ];\n      },\n      validateAndGoRoute(routeNum) {\n        if (routeNum === routeMapping.index) {\n          this.initialUserData();\n        }\n        this.changeTransition(routeNum);\n        this.currentRoute = routeNum;\n      },\n      changeTransition(routeNum) {\n        // 跳轉前改變 transtion 動態\n        if (this.currentRoute < routeNum) {\n          this.controlTransition.enter = '';\n          this.controlTransition.leave = 'animated slideOutLeft faster';\n        } else {\n          this.controlTransition.enter = 'animated slideInLeft faster';\n          this.controlTransition.leave = '';\n        }\n      },\n      submitUserData(type) {\n        switch (type) {\n          case 'name':\n            if (!this.userData.username) return;\n            this.setUsernameDialogs.push({\n              target: this.userData.username,\n              text: this.userData.username\n            });\n            this.inputStatus.getUsername = false;\n            setTimeout(() => {\n              this.setUsernameDialogs.push({\n                target: 'robot',\n                text: `${this.userData.username}你好~你幾號出生呢！告訴我\u000b方便幫你配對年紀相仿的對象喔~`\n              });\n              this.inputStatus.getUserdate = true;\n            }, 1000);\n            break;\n          case 'date':\n            if (!this.userData.userdate) return;\n            this.setUsernameDialogs.push({\n              target: this.userData.username,\n              text: this.userData.userdate\n            });\n            this.inputStatus.getUserdate = false;\n            setTimeout(() => {\n              this.setUsernameDialogs.push({\n                target: 'robot',\n                text: '好吧!其實我根本不 care 你生日，即使你亂打我也沒差，因為我沒時間寫驗證。欸~那不知道是男是女呢?'\n              });\n              this.inputStatus.getUsergender = true;\n            }, 1000);\n            break;\n          case 'gender':\n            if (!this.userData.usergender) return;\n            this.setUsernameDialogs.push({\n              target: this.userData.username,\n              text: this.userData.usergender\n            });\n            this.inputStatus.getUsergender = false;\n            this.maskTitle = '資料確認完成';\n            this.isMaskOpen = true;\n            setTimeout(() => {\n              this.currentRoute = routeMapping.roomLobby;\n              this.isMaskOpen = false;\n            }, 2000);\n            break;\n          default: return;\n        }\n      },\n      showRoomCommentAmount(room) {\n        return room.chatData ? Object.keys(room.chatData).length : 0;\n      },\n      toggleMenu() {\n        this.newRoomData = {\n          name: null,\n        };\n        this.isMenuOpen = !this.isMenuOpen;\n      },\n      goChatRoom(room) {\n        this.listenRoomData(room);\n        this.currentRoomData.roomId = room.id;\n        this.currentRoomData.name = room.name;\n        this.changeTransition(routeMapping.chatRoom);\n        this.currentRoute = routeMapping.chatRoom;\n      },\n      createNewRoom() {\n        let isAble = true;\n        for (let key in this.newRoomData) {\n          if (!this.newRoomData[key]) {\n            isAble = false;\n            break;\n          }\n        }\n        if (!isAble) {\n          this.inValid = true;\n          setTimeout(() => {\n            this.inValid = false;\n          }, 3000);\n          return;\n        } else {\n          this.maskTitle = '創建成功';\n          this.isMaskOpen = true;\n          const roomData = {\n            id: `room${new Date().getTime()}`,\n            name: this.newRoomData.name,\n            description: this.newRoomData.description,\n            chatData: {},\n          };\n          this.writeRoomsData(roomData);\n          this.goChatRoom(roomData);\n          setTimeout(() => {\n            this.isMaskOpen = false;\n            this.isMenuOpen = false;\n          }, 2000);\n        }\n      },\n      appendEmoji(emoji) {\n        this.chatData.input += emoji;\n      },\n      addChat(type) {\n        switch (type) {\n          case 'text':\n            if (!this.chatData.input) return;\n            this.writeRoomData(this.currentRoomData.roomId, {\n              target: this.userData.username,\n              text: this.chatData.input,\n              timeStamp: new Date().getTime(),\n              imageUrl: null,\n            });\n            break;\n          case 'imageUrl':\n            if (!this.chatData.imageUrl) return;\n            this.writeRoomData(this.currentRoomData.roomId, {\n              target: this.userData.username,\n              text: null,\n              timeStamp: new Date().getTime(),\n              imageUrl: this.chatData.imageUrl,\n            });\n            $('#setImageModal').modal('hide');\n            break;\n          default: return;\n        }\n        this.chatData = {\n          search: '',\n          input: '',\n          imageUrl: '',\n        };\n        setTimeout(() => {\n          this.$refs.chatRoomList.scrollTo(0, this.$refs.chatRoomList.scrollHeight + 500);\n        }, 0);\n      },\n      listenRoomsData() {\n        const roomRef = database.ref();\n        roomRef.on('value', (snapshot) => {\n          this.roomList = snapshot.val();\n        });\n      },\n      writeRoomsData(roomData) {\n        database.ref(roomData.id).set({\n          id: roomData.id,\n          name: roomData.name,\n          description: roomData.description,\n          chatData: {},\n        });\n      },\n      listenRoomData(room) {\n        const roomRef = database.ref(`${room.id}/chatData`);\n        roomRef.on('value', (snapshot) => {\n          this.chatRoomDialogs = snapshot.val();\n        });\n      },\n      writeRoomData(room, chatData) {\n        database.ref(`${room}/chatData`).push({\n          target: chatData.target,\n          text: chatData.text,\n          timeStamp: chatData.timeStamp,\n          imageUrl: chatData.imageUrl,\n        });\n      }\n    },\n    created() {\n      this.listenRoomsData();\n    }\n  });\n});\n"]}