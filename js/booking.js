"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}var vm=null;window.onload=function(){vm=new Vue({el:"#app",data:function(){return{axios:null,roomsInfo:[],roomDetail:[],bookingStep:1,roomDetailisLoading:!0,submitLoading:!1,pickerOptions:{disabledDate:function(e){var t=vm.roomDetail.booking,o=!1;return t.forEach(function(t){e.getFullYear()==new Date(t.date).getFullYear()&&e.getMonth()==new Date(t.date).getMonth()&&e.getDate()==new Date(t.date).getDate()&&(o=!0)}),o||(e.getTime()<(new Date).getTime()||e.getTime()>(new Date).getTime()+79488e5)}},formBooking:{name:"",tel:"",email:""},formDate:null,formDateSeparate:[null,null],formBookingRule:{name:[{required:!0,message:"請輸入姓名",trigger:"blur"}],tel:[{required:!0,message:"請輸入聯絡電話",trigger:"blur"}],email:[{required:!0,message:"請輸入 email",trigger:"blur"},{type:"email",message:"請輸入正確的 email 格式",trigger:["blur","change"]}]},submitDialogVisible:!1}},computed:{bookingTotalDays:function(){var t=new Date(this.formDate[0]).getTime();return(new Date(this.formDate[1]).getTime()-t)/1e3/60/60/24},bookingTotalDates:function(){for(var t=new Date(this.formDate[0]).getTime(),e=[this.formDate[0]],o=1;o<=this.bookingTotalDays;o++){var a=new Date(t+864e5*o),i=a.getFullYear(),r=(a.getMonth()+1).toString().padStart(2,0),n=a.getDate().toString().padStart(2,0);e.push(i+"-"+r+"-"+n)}return e},bookingTotalPrice:function(){return this.formDate?this.roomDetail.room[0].normalDayPrice*this.bookingTotalDays:0}},methods:{scrollToRooms:function(){this.bookingStep=1,this.scrollToElement(".title")},scrollToElement:function(t){var e=document.querySelector(""+t).getBoundingClientRect().top-2*document.querySelector(".title").offsetHeight,o=window.scrollY,a=o,i=null;i=0<e?setInterval(function(){a<e+o?(window.scrollTo(0,a),a+=5):clearInterval(i)},0):setInterval(function(){e+o<a?(window.scrollTo(0,a-5),a-=5):clearInterval(i)},0)},formatToFormDate:function(){if(this.formDateSeparate[0]&&this.formDateSeparate[0]){if(this.formDateSeparate[0]===this.formDateSeparate[1])return this.$message.error("開始及結束日期不能相同"),void(this.formDateSeparate=[null,null]);if(this.formDateSeparate[0]&&this.formDateSeparate[1]){var t=this.formDateSeparate.slice().sort(function(t,e){return new Date(t).getTime()-new Date(e).getTime()});this.formDateSeparate=t,this.formDate=t}}},checkIfSameDate:function(){if(this.formDate[0]===this.formDate[1])return this.$message.error("開始及結束日期不能相同"),void(this.formDate=null);this.formDateSeparate=[].concat(_toConsumableArray(this.formDate))},showRoomDetail:function(t){var e=this;this.bookingStep=2,this.roomDetailisLoading=!0,this.axios.get("/room/"+t).then(function(t){t.data.success&&(e.roomDetail=t.data,e.roomDetailisLoading=!1,setTimeout(function(){e.scrollToElement(".title")},500))})},showSubmitDialog:function(){this.formDate?this.submitDialogVisible=!0:this.$message.error("請選擇開始及結束日期")},submitBooking:function(){var e=this;this.$refs.formBooking.validate(function(t){if(!t)return!1;e.submitLoading=!0;var o=new FormData;o.append("name",e.formBooking.name),o.append("tel",e.formBooking.tel),e.bookingTotalDates.forEach(function(t,e){o.append("date["+e+"]",t)}),e.axios.post("/room/"+e.roomDetail.room[0].id,o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){t.data.success&&(e.bookingStep=3,e.submitDialogVisible=!1)})})},resetForm:function(){this.submitDialogVisible=!1,this.$refs.formBooking.resetFields()},resetAllData:function(){this.formDate=null,this.formBooking={name:"",tel:"",email:""},this.formDateSeparate=[null,null]},fixScrollDisappear:function(){document.body.style.overflow="initial"}},watch:{bookingStep:function(t){2===t&&this.resetAllData()}},created:function(){var e=this;this.axios=axios.create({baseURL:"https://challenge.thef2e.com/api/thef2e2019/stage6",timeout:5e3,headers:{Acctept:"application/json",Authorization:"Bearer euQEgajjI9dbwkiVreUIsLvRDdKbqDQKAhnj678BLygJKajkPchRzS9COCc"}}),this.axios.get("/rooms").then(function(t){t.data.success&&(e.roomsInfo=t.data.items)})}})};
//# sourceMappingURL=booking.js.map
