{"version":3,"sources":["mp3player.js"],"names":["tag","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","player","onYouTubeIframeAPIReady","YT","Player","height","width","videoId","events","vm","onPlayerStateChange","$","Vue","el","data","slideMenu","showList","playlist","ads","activePlaylistIndex","activeAdIndex","menuList","currentPlaylist","currentSongIndex","currentSongTime","songTimer","isRandom","isPlay","volumn","isSlide","pos","originX","moveX","innerWidth","outerWidth","computed","currentSong","list","displayTimeBar","currentSongTotalTime","list_duration","percent","displayVolBar","methods","toggleList","e","target","next","slideUp","slideDown","showMenuList","cataType","payload","tempArr","forEach","sort","a","b","aa","toLowerCase","trim","bb","title","filter","l","favorite","PlayerState","ENDED","playSong","step","from","callPlayer","randomIndex","getRandomNum","length","tempSong","loadVideoById","id","setSongTimer","cueVideoById","changeSongState","boolean","setVolume","playVideo","pauseVideo","clearInterval","Math","floor","random","setInterval","getCurrentTime","switchAds","css","display","eq","setTimeout","onmouseDown","x","parent","onmouseMove","distance","totalWidth","onmouseUp","type","toFixed","seekTo","filters","formatTime","val","minute","second","substr","created","getJSON","res","mounted"],"mappings":"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","file":"mp3player.js","sourcesContent":["const tag = document.createElement('script');\ntag.src = \"https://www.youtube.com/iframe_api\";\nconst firstScriptTag = document.getElementsByTagName('script')[0];\nfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\nlet player = null;\n\nfunction onYouTubeIframeAPIReady() {\n  player = new YT.Player('js_player', {\n    height: '0',\n    width: '0',\n    videoId: 'lzkKzZmRZk8',\n    events: {\n      'onStateChange': vm.onPlayerStateChange\n    }\n  });\n}\n\nlet vm = null;\n\n$(function() {\n  vm = new Vue({\n    el: '#app',\n    data: {\n      slideMenu: true,\n      showList: true,\n      playlist: [],\n      ads: [],\n      activePlaylistIndex: 0,\n      activeAdIndex: 0,\n      menuList: {},\n      currentPlaylist: {},\n      currentSongIndex: 0,\n      currentSongTime: 0,\n      songTimer: null,\n      isRandom: false,\n      isPlay: false,\n      volumn: 0.5,\n      isSlide: false,\n      pos: {\n        originX: 0,\n        moveX: 0,\n        innerWidth: 0,\n        outerWidth: 0,\n      }\n    },\n    computed: {\n      currentSong() {\n        if (this.currentPlaylist.list) {\n          return this.currentPlaylist.list[this.currentSongIndex];\n        }\n        return '';\n      },\n      displayTimeBar() {\n        if (this.currentPlaylist.list) {\n          const currentSongTotalTime = this.currentPlaylist.list[this.currentSongIndex].list_duration;\n          const percent = this.currentSongTime / currentSongTotalTime * 100;\n          return {\n            width: percent + '%',\n          }\n        }\n        return '';\n      },\n      displayVolBar() {\n        const percent = this.volumn / 1 * 100;\n        return {\n          width: percent + '%',\n        }\n      }\n    },\n    methods: {\n      toggleList(e) {\n        this.showList ? $(e.target).next().slideUp('fast')\n          : $(e.target).next().slideDown('fast');\n        this.showList = !this.showList;\n      },\n      showMenuList(cataType, payload) {\n        let tempArr = [];\n        switch(cataType) {\n          case 1:\n            this.activePlaylistIndex = payload;\n            this.menuList = this.playlist[payload];\n            break;\n          case 2:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list];\n            });\n            tempArr.sort((a,b) => {\n              const aa = a['artist_name'].toLowerCase().trim();\n              const bb = b['artist_name'].toLowerCase().trim();\n              return aa === bb ? 0 : aa < bb ? -1 : 1;\n            });\n            this.menuList = {\n              title: '歌手',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          case 3:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list.filter(l => l.favorite)];\n            });\n            this.menuList = {\n              title: '我的最愛',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          default:\n            break;\n        }\n      },\n      onPlayerStateChange(e) {\n        if (e.data === YT.PlayerState.ENDED) {\n          this.playSong(1);\n        }\n      },\n      playSong(step, from) {\n        this.currentPlaylist = this.menuList;\n        // 從播放清單選取\n        if (from === 'list') {\n          this.currentSongIndex = step;\n          this.callPlayer();\n          return;\n        }\n        // 隨機播放清單歌曲\n        if (this.isRandom) {\n          let randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          if (randomIndex === this.currentSongIndex) {\n            randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          }\n          this.currentSongIndex = randomIndex;\n          this.callPlayer();\n          return;\n        }\n        // 依照順序播放上下首\n        const tempSong = this.currentPlaylist.list[this.currentSongIndex + step];\n        if (!tempSong) {\n          if (step === 1) {\n            this.currentSongIndex = 0;\n          } else {\n            this.currentSongIndex = this.currentPlaylist.list.length-1;\n          }\n        } else {\n          this.currentSongIndex += step;\n        }\n        this.callPlayer();\n      },\n      callPlayer() {\n        // 讀取 youtube 音源\n        if (this.isPlay) {\n          player.loadVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n          this.setSongTimer();\n        } else {\n          player.cueVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n        }\n      },\n      changeSongState(boolean) {\n        this.isPlay = boolean;\n        player.setVolume(this.volumn*100);\n        if (this.isPlay) {\n          player.playVideo();\n          this.setSongTimer();\n        } else {\n          player.pauseVideo();\n          clearInterval(this.songTimer);\n        }\n      },\n      getRandomNum(length) {\n        return Math.floor(Math.random() * length);\n      },\n      setSongTimer() {\n        this.songTimer = setInterval(() => {\n          if (!this.isSlide) {\n            this.currentSongTime = Math.floor(player.getCurrentTime());\n          }\n        }, 1000);\n      },\n      switchAds() {\n        $('.ads').css({\n          display: 'none',\n        });\n        if (this.activeAdIndex === this.ads.length){\n          this.activeAdIndex = 0;\n        }\n        $('.ads').eq(this.activeAdIndex).css({\n          display: 'block',\n        })\n        this.activeAdIndex++;\n        setTimeout(() => {\n          this.switchAds();\n        }, 5000);\n      },\n      onmouseDown(e) {\n        this.isSlide = true;\n        this.pos.originX = e.x;\n        this.pos.innerWidth = $(e.target).parent().width();\n        this.pos.outerWidth = $(e.target).parent().parent().width();\n      },\n      onmouseMove(e) {\n        if (this.isSlide) {\n          this.pos.moveX = e.x;\n          const distance = this.pos.moveX - this.pos.originX;\n          let totalWidth = this.pos.innerWidth + distance;\n          if (totalWidth >= this.pos.outerWidth) {\n            totalWidth = this.pos.outerWidth;\n          } else if (totalWidth < 0) {\n            totalWidth = 0;\n          }\n          $(e.target).parent().width(totalWidth);\n        }\n      },\n      onmouseUp(e, type) {\n        this.isSlide = false;\n        this.pos.innerWidth = $(e.target).parent().width();\n        const percent = (this.pos.innerWidth / this.pos.outerWidth).toFixed(1);\n        if (type === 'vol') {\n          this.volumn = +percent;\n          player.setVolume(this.volumn*100);\n        } else if (type === 'time') {\n          this.currentSongTime = Math.floor(this.currentPlaylist.list[this.currentSongIndex].list_duration * percent);\n          player.seekTo(this.currentSongTime, true);\n        }\n      },\n    },\n    filters: {\n      formatTime(val) {\n        const minute = '00' + Math.floor(val/60);\n        const second = '00' + (val%60);\n        return `${minute.substr(-2)}:${second.substr(-2)}`;\n      },\n    },\n    created() {\n      $.getJSON('../json/mp3player.json', (res) => {\n        this.playlist = res.playlist;\n        this.ads = res.ads;\n        this.menuList = this.playlist[this.activePlaylistIndex];\n        this.currentPlaylist = this.menuList;\n      });\n    },\n    mounted() {\n      this.switchAds();\n    },\n  });\n});"]}