{"version":3,"sources":["mp3player.js"],"names":["tag","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","player","YT","Player","$canvas","ctx","ww","hh","onStateChange","vm","onPlayerStateChange","videoId","events","el","data","slideMenu","showList","playlist","ads","activePlaylistIndex","activeAdIndex","menuList","currentSongIndex","currentSongTime","songTimer","currentPlaylist","list","this","computed","currentSong","list_duration","currentSongTotalTime","toggleList","slideUp","$","e","target","next","slideDown","showMenuList","cataType","payload","methods","tempArr","forEach","_toConsumableArray","a","b","aa","toLowerCase","trim","bb","sort","title","PlayerState","ENDED","playSong","step","from","randomIndex","getRandomNum","length","callPlayer","tempSong","isPlay","loadVideoById","id","cueVideoById","changeSongState","boolean","setSongTimer","setVolumn","pauseVideo","playVideo","random","clearInterval","setInterval","clearCdArc","_this","Math","floor","getCurrentTime","switchAds","_this2","css","display","eq","setTimeout","setVolume","volumn","setCurrentSongTime","seekTo","drawCdArc","width","fillRect","save","translate","i","beginPath","randomNum","arc","cdRadius","start_angle","end_angle","lineWidth","fillStyle","restore","stroke","val","substr","second","res","_this3","filters","mounted","getContext","created","height","window","addEventListener","getJSON","_this4"],"mappings":"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","file":"mp3player.js","sourcesContent":["const tag = document.createElement('script');\ntag.src = \"https://www.youtube.com/iframe_api\";\nconst firstScriptTag = document.getElementsByTagName('script')[0];\nfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\nlet player = null;\nlet vm = null;\nlet $canvas, ctx, ww, hh;\n\nfunction onYouTubeIframeAPIReady() {\n  player = new YT.Player('js_player', {\n    height: '0',\n    width: '0',\n    videoId: 'lzkKzZmRZk8',\n    events: {\n      'onStateChange': vm.onPlayerStateChange\n    }\n  });\n}\n\n$(function() {\n  vm = new Vue({\n    el: '#app',\n    data: {\n      slideMenu: true,\n      showList: true,\n      playlist: [],\n      ads: [],\n      activePlaylistIndex: 0,\n      activeAdIndex: 0,\n      menuList: {},\n      currentPlaylist: {},\n      currentSongIndex: 0,\n      currentSongTime: 0,\n      songTimer: null,\n      isRandom: false,\n      isPlay: false,\n      volumn: 0.5,\n    },\n    computed: {\n      currentSong() {\n        if (this.currentPlaylist.list) {\n          return this.currentPlaylist.list[this.currentSongIndex];\n        }\n        return '';\n      },\n      currentSongTotalTime() {\n        if (this.currentPlaylist.list) {\n          return this.currentPlaylist.list[this.currentSongIndex].list_duration;\n        }\n        return '';\n      },\n    },\n    methods: {\n      toggleList(e) {\n        this.showList ? $(e.target).next().slideUp('fast')\n          : $(e.target).next().slideDown('fast');\n        this.showList = !this.showList;\n      },\n      showMenuList(cataType, payload) {\n        let tempArr = [];\n        switch(cataType) {\n          case 1:\n            this.activePlaylistIndex = payload;\n            this.menuList = this.playlist[payload];\n            break;\n          case 2:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list];\n            });\n            tempArr.sort((a,b) => {\n              const aa = a['artist_name'].toLowerCase().trim();\n              const bb = b['artist_name'].toLowerCase().trim();\n              return aa === bb ? 0 : aa < bb ? -1 : 1;\n            });\n            this.menuList = {\n              title: '歌手',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          case 3:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list.filter(l => l.favorite)];\n            });\n            this.menuList = {\n              title: '我的最愛',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          default:\n            break;\n        }\n      },\n      onPlayerStateChange(e) {\n        if (e.data === YT.PlayerState.ENDED) {\n          this.playSong(1);\n        }\n      },\n      playSong(step, from) {\n        this.currentPlaylist = this.menuList;\n        // 從播放清單選取\n        if (from === 'list') {\n          this.currentSongIndex = step;\n          this.callPlayer();\n          return;\n        }\n        // 隨機播放清單歌曲\n        if (this.isRandom) {\n          let randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          if (randomIndex === this.currentSongIndex) {\n            randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          }\n          this.currentSongIndex = randomIndex;\n          this.callPlayer();\n          return;\n        }\n        // 依照順序播放上下首\n        const tempSong = this.currentPlaylist.list[this.currentSongIndex + step];\n        if (!tempSong) {\n          if (step === 1) {\n            this.currentSongIndex = 0;\n          } else {\n            this.currentSongIndex = this.currentPlaylist.list.length-1;\n          }\n        } else {\n          this.currentSongIndex += step;\n        }\n        this.callPlayer();\n      },\n      callPlayer() {\n        // 讀取 youtube 音源\n        if (this.isPlay) {\n          player.loadVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n          this.setSongTimer();\n        } else {\n          player.cueVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n        }\n      },\n      changeSongState(boolean) {\n        this.isPlay = boolean;\n        this.setVolumn();\n        if (this.isPlay) {\n          player.playVideo();\n          this.setSongTimer();\n        } else {\n          player.pauseVideo();\n          clearInterval(this.songTimer);\n          this.clearCdArc();\n        }\n      },\n      getRandomNum(length) {\n        return Math.floor(Math.random() * length);\n      },\n      setSongTimer() {\n        this.songTimer = setInterval(() => {\n          if (!this.isSlide) {\n            this.currentSongTime = Math.floor(player.getCurrentTime());\n          }\n        }, 1000);\n      },\n      switchAds() {\n        $('.ads').css({\n          display: 'none',\n        });\n        if (this.activeAdIndex === this.ads.length){\n          this.activeAdIndex = 0;\n        }\n        $('.ads').eq(this.activeAdIndex).css({\n          display: 'block',\n        })\n        this.activeAdIndex++;\n        setTimeout(() => {\n          this.switchAds();\n        }, 5000);\n      },\n      setVolumn() {\n        player.setVolume(this.volumn * 100);\n      },\n      setCurrentSongTime() {\n        player.seekTo(this.currentSongTime, true);\n      },\n      drawCdArc() {\n        const cdRadius = $('.player_cd').width()/2;\n        ctx.fillStyle=\"#fff\";\n        ctx.fillRect(0, 0, ww, hh);\n        ctx.save();\n          ctx.translate(ww/2, hh/2);\n          for(var i=0;i<3;i++){\n            const randomNum = this.getRandomNum(5) + 5;\n            ctx.beginPath();\n            let start_angle = i*randomNum;\n            let end_angle = i/0.5+Math.PI/randomNum;\n            ctx.arc(0, 0, cdRadius + i*8+10, start_angle, end_angle);\n            ctx.lineWidth = 3;\n            ctx.strokeStyle= `rgba(0,0,0,${1 - (i/3)})`;\n            ctx.stroke();\n          }\n        ctx.restore();\n      },\n      clearCdArc() {\n        ctx.save();\n          ctx.fillStyle=\"#fff\";\n          ctx.fillRect(0, 0, ww, hh);\n        ctx.restore();\n      },\n    },\n    filters: {\n      formatTime(val) {\n        const minute = '00' + Math.floor(val/60);\n        const second = '00' + (val%60);\n        return `${minute.substr(-2)}:${second.substr(-2)}`;\n      },\n    },\n    created() {\n      $.getJSON('./json/mp3player.json', (res) => {\n        this.playlist = res.playlist;\n        this.ads = res.ads;\n        this.menuList = this.playlist[this.activePlaylistIndex];\n        this.currentPlaylist = this.menuList;\n      });\n    },\n    mounted() {\n      this.switchAds();\n      $canvas = $('#js_cdCanvas');\n      ctx = $canvas[0].getContext('2d');\n      ww = $canvas[0].width = $('.player').width();\n      hh = $canvas[0].height = $('.player_cd').height() + 60;\n      window.addEventListener(\"resize\", function() {\n        ww = $canvas[0].width = $('.player').width();\n        hh = $canvas[0].height = $('.player_cd').height() + 60;\n      });\n      setInterval(() => {\n        if (this.isPlay) {\n          this.drawCdArc();\n        }\n      }, 500);\n    },\n  });\n});"]}