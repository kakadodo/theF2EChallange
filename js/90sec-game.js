"use strict";var _createClass=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var game=void 0,emitter=void 0,controller=void 0,alignGrid=void 0,GameModal=function e(){_classCallCheck(this,e),this.gameDueTime=0,this.isPlay=!1,this.duckMoveSpeed=150,this.objSpeed=150,this.fireBallTime=3,this.isSuperDuck=!1},Controller=function(){function e(){_classCallCheck(this,e),emitter.on("setDuckMoveSpeed",this.setDuckMoveSpeed),emitter.on("restartGame",this.restartGame)}return _createClass(e,[{key:"setDuckMoveSpeed",value:function(e){modal.duckMoveSpeed=e}},{key:"restartGame",value:function(){modal.gameDueTime=0,modal.isPlay=!1,modal.duckMoveSpeed=150,modal.objSpeed=100,modal.fireBallTime=3,modal.isSuperDuck=!1,game.scene.start("SceneStart",!0)}}]),e}(),modal=new GameModal,uiConfig={canvasBgColor:"0x000000",fontFamily:"Roboto, 'Microsoft JhengHei'",gridColWidth:75,gridColHeight:150,gameTime:90};window.onload=function(){WebFont.load({google:{families:["Roboto"]}});var e={type:Phaser.AUTO,width:1200,height:900,backgroundColor:uiConfig.canvasBgColor,physics:{default:"arcade",arcade:{debug:!1}},parent:"game",scale:{parent:"game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1200,height:900},scene:[SceneLoad,SceneStart]};game=new Phaser.Game(e)};var SceneLoad=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"SceneLoad"))}return _inherits(e,Phaser.Scene),_createClass(e,[{key:"preload",value:function(){this.progressText=this.add.text(game.config.width/2,game.config.height/2,"0%",{color:"#ffffff",fontFamily:uiConfig.fontFamily,fontSize:game.config.width/40}),this.progressText.setOrigin(.5),this.load.on("progress",this.onProgress,this),this.load.image("bgTop","./img/2nd-week5/bg_top.png"),this.load.image("bgMiddle","./img/2nd-week5/bg_middle.png"),this.load.image("bgBottom","./img/2nd-week5/bg_bottom.png"),this.load.image("boss1","./img/2nd-week5/boss1.png"),this.load.image("boss2","./img/2nd-week5/boss2.png"),this.load.image("goal","./img/2nd-week5/goal.png"),this.load.image("superStar","./img/2nd-week5/superStar.png"),this.load.spritesheet("ballSprite","./img/2nd-week5/ball_sprite.png",{frameWidth:110,frameHeight:110}),this.load.spritesheet("duckSprite","./img/2nd-week5/duck_sprite.png",{frameWidth:124,frameHeight:150}),this.load.spritesheet("btnLeftSprite","./img/2nd-week5/btnLeft_sprite.png",{frameWidth:50,frameHeight:55}),this.load.spritesheet("btnRightSprite","./img/2nd-week5/btnRight_sprite.png",{frameWidth:50,frameHeight:55}),this.load.spritesheet("btnStart","./img/2nd-week5/btnStart_sprite.png",{frameWidth:150,frameHeight:55}),this.load.spritesheet("clearSprite","./img/2nd-week5/clear_sprite.png",{frameWidth:190,frameHeight:155})}},{key:"create",value:function(){emitter=new Phaser.Events.EventEmitter,controller=new Controller,this.title=this.add.text(game.config.width/2,game.config.height/2-250,"90sec Game",{color:"#FDD23F",stroke:"#F49C24",strokeThickness:6,fontFamily:uiConfig.fontFamily,fontSize:72,shadow:{color:"#9A7B5D",blur:2,fill:!0,offsetY:5}}),this.title.setOrigin(.5),this.duck=this.add.sprite(game.config.width/2,game.config.height/2-110,"duckSprite"),this.anims.create({key:"walk",frames:[{key:"duckSprite",frame:0},{key:"duckSprite",frame:1},{key:"duckSprite",frame:2}],frameRate:8,repeat:-1}),this.duck.play("walk"),this.btnStart=new FlatButton({scene:this,key:"btnStart",text:"開始遊戲",x:game.config.width/2,y:game.config.height/2+100,event:"startGame"}),emitter.on("startGame",this.startGame,this)}},{key:"onProgress",value:function(e){this.progressText.setText(Math.floor(100*e)+"%")}},{key:"startGame",value:function(){this.scene.start("SceneStart")}}]),e}(),SceneStart=function(){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"SceneStart"))}return _inherits(e,Phaser.Scene),_createClass(e,[{key:"init",value:function(){this.cursors=this.input.keyboard.createCursorKeys(),this.physics.world.setBounds(3*uiConfig.gridColWidth,5*-uiConfig.gridColHeight,10*uiConfig.gridColWidth,15*uiConfig.gridColHeight),this.cameras.main.setBounds(0,0,game.config.width,game.config.height)}},{key:"create",value:function(){alignGrid=new AlignGrid({rows:6,cols:16,scene:this}),this.bgMiddle=this.add.tileSprite(game.config.width/2,game.config.height/2,game.config.width,game.config.height,"bgMiddle"),this.bgBottom=new Wall({scene:this,x:game.config.width/2,y:game.config.height-121,key:"bgBottom",origin:{x:.5,y:0}}),this.bgTop=new Wall({scene:this,x:game.config.width/2,y:-121,key:"bgTop",origin:{x:.5,y:0}}),this.ballGroup=this.physics.add.group(),this.superStarGroup=this.physics.add.group(),this.duck=this.physics.add.sprite(game.config.width/2,game.config.height/2-110,"duckSprite"),this.duck.setCollideWorldBounds(!0),this.duck.setImmovable(!0),this.duck.setSize(60,120),this.anims.create({key:"swim",frames:[{key:"duckSprite",frame:0},{key:"duckSprite",frame:1},{key:"duckSprite",frame:2}],frameRate:5,repeat:-1}),this.duck.play("swim"),this.anims.create({key:"rush",frames:[{key:"duckSprite",frame:3},{key:"duckSprite",frame:4},{key:"duckSprite",frame:5}],frameRate:8,repeat:-1}),this.createTimeBoxCon(),alignGrid.placeAt(7,4,this.duck),this.countDownTimer=this.time.addEvent({delay:1e3,callback:this.checkCountDownTimer,callbackScope:this,repeat:3}),this.btnLeft=this.add.sprite(game.config.width-200,game.config.height-100,"btnLeftSprite"),this.btnRight=this.add.sprite(game.config.width-145,game.config.height-100,"btnRightSprite"),this.physics.add.collider(this.ballGroup),this.physics.add.collider(this.duck,this.ballGroup,this.hitTheBall.bind(this)),this.physics.add.collider(this.ballGroup,this.superStarGroup),this.physics.add.overlap(this.duck,this.superStarGroup,this.hitTheSuperStar.bind(this))}},{key:"update",value:function(){modal.isPlay&&(modal.isSuperDuck?this.bgMiddle.tilePositionY-=.02*modal.objSpeed:this.bgMiddle.tilePositionY-=.005*modal.objSpeed,this.duck.body.velocity.x=0,this.cursors.left.isDown?(this.duck.body.velocity.x=-modal.duckMoveSpeed,this.btnLeft.setFrame(1),this.btnLeft.y=game.config.height-95):this.cursors.right.isDown?(this.duck.body.velocity.x=modal.duckMoveSpeed,this.btnRight.setFrame(1),this.btnRight.y=game.config.height-95):(this.btnLeft.setFrame(0),this.btnRight.setFrame(0),this.btnLeft.y=game.config.height-100,this.btnRight.y=game.config.height-100),this.boss1&&this.boss1.y>game.config.height+this.boss1.height/2&&(this.boss1.setActive(!1),this.boss1.setVisible(!1),this.boss1.destroy()),this.boss2&&this.boss2.y>game.config.height+this.boss2.height/2&&(this.boss2.setActive(!1),this.boss2.setVisible(!1),this.boss2.destroy()),this.ballGroup.children.iterate(function(e){e&&e.y>game.config.height+e.height/2&&(e.setActive(!1),e.setVisible(!1),e.destroy())},this),this.superStarGroup.children.iterate(function(e){e&&e.y>game.config.height+e.height/2&&(e.setActive(!1),e.setVisible(!1),e.destroy())},this),this.physics.add.collider(this.ballGroup,this.boss1),this.physics.add.collider(this.ballGroup,this.boss2),this.physics.add.collider(this.duck,this.boss1,this.hitTheBoss.bind(this)),this.physics.add.collider(this.duck,this.boss2,this.hitTheBoss.bind(this)))}},{key:"checkGameTime",value:function(){if(this.countDueTimer){var e=uiConfig.gameTime-modal.gameDueTime;if(0<=e){var t="0"+Math.floor(e/60),i=(e-60*t).toString();i=2===i.length?i:"0"+i,this.timeText.setText(t+":"+i)}else this.countDueTimer.remove(),modal.isPlay=!1}}},{key:"checkCountDownTimer",value:function(){this.countDownText&&this.countDownText.destroy(),this.countDownText=this.add.text(game.config.width/2,game.config.height/2,this.countDownTimer.getRepeatCount(),{fontFamily:uiConfig.fontFamily,fontSize:150}),this.countDownText.setOrigin(.5),0===this.countDownTimer.getRepeatCount()&&(this.countDownText.destroy(),this.countDueTimer=this.time.addEvent({delay:1e3,callback:this.checkCountDueTimer,callbackScope:this,repeat:uiConfig.gameTime}),modal.isPlay=!0,this.tweens.add({targets:this.bgBottom,duration:1e3,y:game.config.height}),this.fireBall())}},{key:"checkCountDueTimer",value:function(){modal.isPlay&&(modal.gameDueTime++,modal.gameDueTime%20==0&&(modal.objSpeed+=50),modal.gameDueTime%modal.fireBallTime==0&&modal.gameDueTime<80&&this.fireBall(),modal.gameDueTime%10==0&&modal.gameDueTime<85&&this.fireSuperStar(),30===modal.gameDueTime&&(modal.fireBallTime=2),50===modal.gameDueTime&&this.fireBoss1(),60===modal.gameDueTime&&(modal.fireBallTime=1),82===modal.gameDueTime&&this.fireBoss2(),modal.gameDueTime===uiConfig.gameTime&&(this.tweens.add({targets:this.bgTop,duration:1e3,y:0}),this.createGoal(),this.endGame()),this.checkGameTime())}},{key:"checkBecomeSuperTimer",value:function(){0===this.becomeSuperTimer.getRepeatCount()&&(this.duck.anims.stop(),this.duck.play("swim"),modal.isSuperDuck=!1,modal.duckMoveSpeed=150)}},{key:"createTimeBoxCon",value:function(){this.timeBox=this.add.graphics(),this.timeBox.fillStyle(5460819),this.timeBox.fillRoundedRect(0,10,3*uiConfig.gridColWidth,uiConfig.gridColHeight,30),this.timeBox.fillStyle(0),this.timeBox.fillRoundedRect(0,0,3*uiConfig.gridColWidth,uiConfig.gridColHeight,30),this.subTimeText=this.add.text(uiConfig.gridColWidth/2,40,"TIME",{fontFamily:uiConfig.fontFamily,fontSize:20}),this.timeText=this.add.text(uiConfig.gridColWidth+uiConfig.gridColWidth/2,uiConfig.gridColHeight-50,"01:30",{fontFamily:uiConfig.fontFamily,fontSize:60}),this.timeText.setOrigin(.5),this.timeBoxCon=this.add.container(),this.timeBoxCon.add(this.timeBox),this.timeBoxCon.add(this.subTimeText),this.timeBoxCon.add(this.timeText),this.timeBoxCon.x=13*uiConfig.gridColWidth,this.timeBoxCon.y=-20}},{key:"createGoal",value:function(){this.goal=this.add.image(0,0,"goal"),alignGrid.placeAt(8,1,this.goal),this.goal.setScale(0),this.goal.opacity=0,this.tweens.add({targets:this.goal,duration:1e3,delay:1e3,scale:1,opacity:1})}},{key:"endGame",value:function(){var t=this;modal.isPlay&&(this.tweens.add({targets:this.duck,duration:1500,delay:2e3,x:650,y:370}),setTimeout(function(){t.gameOverScreen=new GameOverScreen({scene:t,x:game.config.width/2,y:game.config.height/2,title:"Congratulations! 恭喜過關!",btnText:"再來一次..",gameSuccess:!0});for(var e=1;e<=3;e++)t.tweens.add({targets:t.gameOverScreen["clear"+e],duration:1500,delay:500*e,alpha:1})},4200))}},{key:"fireBall",value:function(){for(var e=Math.floor(3*Math.random()+1),t=0;t<e;t++){var i=this.ballGroup.getFirstDead(!1);if(i=i||this.ballGroup.create(0,0,"ballSprite"),alignGrid.placeAt(getRandomColumn(3,10),0,i),i.y=-i.height,i.setSize(90,90),i.setScale(.7),i.setCollideWorldBounds(!0),i.setFrame(Math.floor(4*Math.random())),i.setActive(!0),i.setVisible(!0),i.setVelocityY(modal.objSpeed),60<modal.gameDueTime){var s=Math.random()<.5;i.setVelocityX(s?modal.objSpeed/2:-modal.objSpeed/2),i.setBounceX(.5)}}}},{key:"fireBoss1",value:function(){this.boss1=this.physics.add.sprite(0,0,"boss1"),alignGrid.placeAt(getRandomColumn(4,7),0,this.boss1),this.boss1.y=-this.boss1.height,this.boss1.setSize(350,250),this.boss1.setActive(!0),this.boss1.setVisible(!0),this.boss1.setCollideWorldBounds(!0),this.boss1.setVelocityY(.8*modal.objSpeed)}},{key:"fireBoss2",value:function(){this.boss2=this.physics.add.sprite(0,0,"boss2"),alignGrid.placeAt(getRandomColumn(5,5),0,this.boss2),this.boss2.y=-this.boss2.height,this.boss2.setSize(550,300),this.boss2.setScale(.9),this.boss2.setActive(!0),this.boss2.setVisible(!0),this.boss2.setCollideWorldBounds(!0),this.boss2.setVelocityY(.8*modal.objSpeed)}},{key:"fireSuperStar",value:function(){var e=this.superStarGroup.getFirstDead(!1);e=e||this.superStarGroup.create(0,0,"superStar"),alignGrid.placeAt(getRandomColumn(3,10),0,e),e.y=-e.height,e.setSize(70,70),e.setActive(!0),e.setVisible(!0),e.setVelocityY(.6*modal.objSpeed)}},{key:"hitTheBall",value:function(e,t){modal.isPlay&&(modal.isPlay=!1,this.ballGroup.setVelocityY(0),this.superStarGroup.setVelocityY(0),this.boss1&&this.boss1.body&&this.boss1.setVelocityY(0),this.boss2&&this.boss2.body&&this.boss2.setVelocityY(0),this.duck.anims.stop(),this.duck.setFrame(6),e.body.velocity.x=0,this.gameOverScreen=new GameOverScreen({scene:this,x:game.config.width/2,y:game.config.height/2,title:"UH-OH! 觸礁了",subTitle:"勝敗乃鴨家常事，大俠重新來過吧~",btnText:"重新挑戰",gameSuccess:!1}))}},{key:"hitTheBoss",value:function(e,t){modal.isPlay&&(modal.isPlay=!1,t.setVelocityY(0),this.ballGroup.setVelocityY(0),this.superStarGroup.setVelocityY(0),this.duck.anims.stop(),this.duck.setFrame(6),e.body.velocity.x=0,this.gameOverScreen=new GameOverScreen({scene:this,x:game.config.width/2,y:game.config.height/2,title:"UH-OH! 觸礁了",subTitle:"勝敗乃鴨家常事，大俠重新來過吧~",btnText:"重新挑戰",gameSuccess:!1}))}},{key:"hitTheSuperStar",value:function(e,t){var i=this;modal.isPlay&&(this.duck.anims.stop(),this.duck.play("rush"),modal.duckMoveSpeed=300,modal.isSuperDuck=!0,this.killSprite("ballGroup"),this.killSprite("superStarGroup"),this.boss1&&this.tweens.add({targets:this.boss1,duration:500,alpha:0,onComplete:function(){i.boss1.body=null,i.boss1.destroy()}}),this.boss2&&this.tweens.add({targets:this.boss2,duration:500,alpha:0,onComplete:function(){i.boss2.body=null,i.boss2.destroy()}}),this.becomeSuperTimer=this.time.addEvent({delay:1e3,callback:this.checkBecomeSuperTimer,callbackScope:this,repeat:3}))}},{key:"killSprite",value:function(e){this[e].getChildren().map(function(e){return e.destroy()})}}]),e}(),FlatButton=function(){function i(e){if(_classCallCheck(this,i),!e.scene)return _possibleConstructorReturn(t);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e.scene));return t.scene=e.scene,t.config=e,t.btn=t.scene.add.sprite(0,0,e.key),t.add(t.btn),e.text&&(t.text=t.scene.add.text(0,0,e.text,{fontFamily:uiConfig.fontFamily,fontSize:30}),t.text.setOrigin(.5),t.add(t.text)),e.x&&(t.x=e.x),e.y&&(t.y=e.y),e.event&&(t.btn.setInteractive({cursor:"pointer"}),t.btn.on("pointerdown",t.onPointerdown,t),t.btn.on("pointerup",t.onPointerup,t)),t.scene.add.existing(t),t}return _inherits(i,Phaser.GameObjects.Container),_createClass(i,[{key:"onPointerdown",value:function(){this.btn.setFrame(1),this.y+=5}},{key:"onPointerup",value:function(){this.btn.setFrame(0),this.y-=5,emitter.emit(this.config.event)}}]),i}(),Wall=function(){function a(e){if(_classCallCheck(this,a),!e.scene)return _possibleConstructorReturn(t);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e.scene));if(t.scene=e.scene,t.config=e,t.wall=t.scene.add.image(0,0,e.key),t.graphics=t.scene.add.graphics(),t.graphics.fillStyle(0),t.graphics.fillRect(-game.config.width,0,game.config.width+game.config.width/2,121),t.add(t.graphics),t.add(t.wall),e.x&&(t.x=e.x),e.y&&(t.y=e.y),e.origin){var i=e.origin,s=i.x,o=i.y;t.wall.setOrigin(s,o)}return t.scene.add.existing(t),t}return _inherits(a,Phaser.GameObjects.Container),_createClass(a,[{key:"onPointerdown",value:function(){this.btn.setFrame(1),this.y+=5}},{key:"onPointerup",value:function(){this.btn.setFrame(0),emitter.emit(this.config.event)}}]),a}(),GameOverScreen=function(){function i(e){if(_classCallCheck(this,i),!e.scene)return _possibleConstructorReturn(t);var t=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e.scene));return t.scene=e.scene,t.config=e,t.graphics=t.scene.add.graphics(),t.graphics.fillStyle(0,.5),t.graphics.fillRect(-game.config.width/2,-game.config.height/2,game.config.width,game.config.height),t.graphics.fillStyle(16777215),t.graphics.fillRoundedRect(0-4*uiConfig.gridColWidth,0-uiConfig.gridColHeight,8*uiConfig.gridColWidth,2*uiConfig.gridColHeight,30),t.add(t.graphics),e.gameSuccess?t.title=t.scene.add.text(0,-110,e.title,{color:"#ff952b",fontFamily:uiConfig.fontFamily,fontSize:36}):t.title=t.scene.add.text(0,-60,e.title,{color:"#ff952b",fontFamily:uiConfig.fontFamily,fontSize:36}),t.title.setOrigin(.5),t.add(t.title),e.gameSuccess?(t.clear1=t.scene.add.sprite(-200,0,"clearSprite",0),t.clear2=t.scene.add.sprite(0,0,"clearSprite",1),t.clear3=t.scene.add.sprite(200,0,"clearSprite",2),t.clear1.alpha=0,t.clear2.alpha=0,t.clear3.alpha=0,t.add(t.clear1),t.add(t.clear2),t.add(t.clear3)):(t.subTitle=t.scene.add.text(0,-10,e.subTitle,{color:"#707070",fontFamily:uiConfig.fontFamily,fontSize:20}),t.subTitle.setOrigin(.5),t.add(t.subTitle)),e.gameSuccess?t.btnRestart=new FlatButton({scene:e.scene,key:"btnStart",text:e.btnText,x:0,y:110,event:"restartGame"}):t.btnRestart=new FlatButton({scene:e.scene,key:"btnStart",text:e.btnText,x:0,y:50,event:"restartGame"}),t.add(t.btnRestart),e.x&&(t.x=e.x),e.y&&(t.y=e.y),t.scene.add.existing(t),t}return _inherits(i,Phaser.GameObjects.Container),_createClass(i,[{key:"onPointerdown",value:function(){this.btn.setFrame(1),this.y+=5}},{key:"onPointerup",value:function(){this.btn.setFrame(0),emitter.emit(this.config.event)}}]),i}(),AlignGrid=function(){function t(e){_classCallCheck(this,t),e.scene&&(this.config=e,this.config.row=e.rows||6,this.config.cols=e.cols||5,this.config.width=e.width||game.config.width,this.config.height=e.height||game.config.height,this.scene=e.scene,this.cw=this.config.width/this.config.cols,this.ch=this.config.height/this.config.rows)}return _createClass(t,[{key:"show",value:function(){this.graphics=this.scene.add.graphics(),this.graphics.lineStyle(2,65280);for(var e=0;e<this.config.width;e+=this.cw)this.graphics.moveTo(e,0),this.graphics.lineTo(e,this.config.height);for(var t=0;t<this.config.height;t+=this.ch)this.graphics.moveTo(0,t),this.graphics.lineTo(this.config.width,t);this.graphics.strokePath()}},{key:"placeAt",value:function(e,t,i){i.x=this.cw*e+this.cw/2,i.y=this.ch*t+this.ch/2}},{key:"placeAtIndex",value:function(e,t){var i=e%this.cols,s=Math.floor(e/this.cols);this.placeAt(i,s,t)}},{key:"showNumbers",value:function(){this.show();for(var e=0,t=0;t<this.config.rows;t++)for(var i=0;i<this.config.cols;i++){var s=this.scene.add.text(0,0,e,"#00ff00");s.setOrigin(.5,.5),this.placeAtIndex(e,s),e++}}}]),t}();function getRandomColumn(e,t){return Math.floor(Math.random()*t)+e}
//# sourceMappingURL=90sec-game.js.map
