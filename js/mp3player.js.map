{"version":3,"sources":["mp3player.js"],"names":["tag","document","createElement","src","firstScriptTag","getElementsByTagName","parentNode","insertBefore","player","vm","$canvas","ctx","ww","hh","onYouTubeIframeAPIReady","YT","Player","height","width","videoId","events","onPlayerStateChange","$","Vue","el","data","slideMenu","showList","playlist","ads","activePlaylistIndex","activeAdIndex","menuList","currentPlaylist","currentSongIndex","currentSongTime","songTimer","isRandom","isPlay","volumn","computed","currentSong","list","currentSongTotalTime","list_duration","methods","toggleList","e","target","next","slideUp","slideDown","showMenuList","cataType","payload","tempArr","forEach","sort","a","b","aa","toLowerCase","trim","bb","title","filter","l","favorite","PlayerState","ENDED","playSong","step","from","callPlayer","randomIndex","getRandomNum","length","tempSong","loadVideoById","id","setSongTimer","cueVideoById","changeSongState","boolean","setVolumn","playVideo","pauseVideo","clearInterval","clearCdArc","Math","floor","random","setInterval","isSlide","getCurrentTime","switchAds","css","display","eq","setTimeout","setVolume","setCurrentSongTime","seekTo","drawCdArc","cdRadius","fillStyle","fillRect","save","translate","i","randomNum","beginPath","start_angle","end_angle","PI","arc","lineWidth","strokeStyle","stroke","restore","filters","formatTime","val","minute","second","substr","created","getJSON","res","mounted","getContext","window","addEventListener"],"mappings":";;;;AAAA,IAAMA,MAAMC,SAASC,aAAT,CAAuB,QAAvB,CAAZ;AACAF,IAAIG,GAAJ,GAAU,oCAAV;AACA,IAAMC,iBAAiBH,SAASI,oBAAT,CAA8B,QAA9B,EAAwC,CAAxC,CAAvB;AACAD,eAAeE,UAAf,CAA0BC,YAA1B,CAAuCP,GAAvC,EAA4CI,cAA5C;AACA,IAAII,SAAS,IAAb;AACA,IAAIC,KAAK,IAAT;AACA,IAAIC,gBAAJ;AAAA,IAAaC,YAAb;AAAA,IAAkBC,WAAlB;AAAA,IAAsBC,WAAtB;;AAEA,SAASC,uBAAT,GAAmC;AACjCN,WAAS,IAAIO,GAAGC,MAAP,CAAc,WAAd,EAA2B;AAClCC,YAAQ,GAD0B;AAElCC,WAAO,GAF2B;AAGlCC,aAAS,aAHyB;AAIlCC,YAAQ;AACN,uBAAiBX,GAAGY;AADd;AAJ0B,GAA3B,CAAT;AAQD;;AAEDC,EAAE,YAAW;AACXb,OAAK,IAAIc,GAAJ,CAAQ;AACXC,QAAI,MADO;AAEXC,UAAM;AACJC,iBAAW,IADP;AAEJC,gBAAU,IAFN;AAGJC,gBAAU,EAHN;AAIJC,WAAK,EAJD;AAKJC,2BAAqB,CALjB;AAMJC,qBAAe,CANX;AAOJC,gBAAU,EAPN;AAQJC,uBAAiB,EARb;AASJC,wBAAkB,CATd;AAUJC,uBAAiB,CAVb;AAWJC,iBAAW,IAXP;AAYJC,gBAAU,KAZN;AAaJC,cAAQ,KAbJ;AAcJC,cAAQ;AAdJ,KAFK;AAkBXC,cAAU;AACRC,iBADQ,yBACM;AACZ,YAAI,KAAKR,eAAL,CAAqBS,IAAzB,EAA+B;AAC7B,iBAAO,KAAKT,eAAL,CAAqBS,IAArB,CAA0B,KAAKR,gBAA/B,CAAP;AACD;AACD,eAAO,EAAP;AACD,OANO;AAORS,0BAPQ,kCAOe;AACrB,YAAI,KAAKV,eAAL,CAAqBS,IAAzB,EAA+B;AAC7B,iBAAO,KAAKT,eAAL,CAAqBS,IAArB,CAA0B,KAAKR,gBAA/B,EAAiDU,aAAxD;AACD;AACD,eAAO,EAAP;AACD;AAZO,KAlBC;AAgCXC,aAAS;AACPC,gBADO,sBACIC,CADJ,EACO;AACZ,aAAKpB,QAAL,GAAgBL,EAAEyB,EAAEC,MAAJ,EAAYC,IAAZ,GAAmBC,OAAnB,CAA2B,MAA3B,CAAhB,GACI5B,EAAEyB,EAAEC,MAAJ,EAAYC,IAAZ,GAAmBE,SAAnB,CAA6B,MAA7B,CADJ;AAEA,aAAKxB,QAAL,GAAgB,CAAC,KAAKA,QAAtB;AACD,OALM;AAMPyB,kBANO,wBAMMC,QANN,EAMgBC,OANhB,EAMyB;AAC9B,YAAIC,UAAU,EAAd;AACA,gBAAOF,QAAP;AACE,eAAK,CAAL;AACE,iBAAKvB,mBAAL,GAA2BwB,OAA3B;AACA,iBAAKtB,QAAL,GAAgB,KAAKJ,QAAL,CAAc0B,OAAd,CAAhB;AACA;AACF,eAAK,CAAL;AACE,iBAAK1B,QAAL,CAAc4B,OAAd,CAAsB,gBAAQ;AAC5BD,qDAAcA,OAAd,sBAA0Bb,KAAKA,IAA/B;AACD,aAFD;AAGAa,oBAAQE,IAAR,CAAa,UAACC,CAAD,EAAGC,CAAH,EAAS;AACpB,kBAAMC,KAAKF,EAAE,aAAF,EAAiBG,WAAjB,GAA+BC,IAA/B,EAAX;AACA,kBAAMC,KAAKJ,EAAE,aAAF,EAAiBE,WAAjB,GAA+BC,IAA/B,EAAX;AACA,qBAAOF,OAAOG,EAAP,GAAY,CAAZ,GAAgBH,KAAKG,EAAL,GAAU,CAAC,CAAX,GAAe,CAAtC;AACD,aAJD;AAKA,iBAAK/B,QAAL,GAAgB;AACdgC,qBAAO,IADO;AAEdtB,oBAAMa;AAFQ,aAAhB;AAIA,iBAAKzB,mBAAL,GAA2B,IAA3B;AACA;AACF,eAAK,CAAL;AACE,iBAAKF,QAAL,CAAc4B,OAAd,CAAsB,gBAAQ;AAC5BD,qDAAcA,OAAd,sBAA0Bb,KAAKA,IAAL,CAAUuB,MAAV,CAAiB;AAAA,uBAAKC,EAAEC,QAAP;AAAA,eAAjB,CAA1B;AACD,aAFD;AAGA,iBAAKnC,QAAL,GAAgB;AACdgC,qBAAO,MADO;AAEdtB,oBAAMa;AAFQ,aAAhB;AAIA,iBAAKzB,mBAAL,GAA2B,IAA3B;AACA;AACF;AACE;AA/BJ;AAiCD,OAzCM;AA0CPT,yBA1CO,+BA0Ca0B,CA1Cb,EA0CgB;AACrB,YAAIA,EAAEtB,IAAF,KAAWV,GAAGqD,WAAH,CAAeC,KAA9B,EAAqC;AACnC,eAAKC,QAAL,CAAc,CAAd;AACD;AACF,OA9CM;AA+CPA,cA/CO,oBA+CEC,IA/CF,EA+CQC,IA/CR,EA+Cc;AACnB,aAAKvC,eAAL,GAAuB,KAAKD,QAA5B;AACA;AACA,YAAIwC,SAAS,MAAb,EAAqB;AACnB,eAAKtC,gBAAL,GAAwBqC,IAAxB;AACA,eAAKE,UAAL;AACA;AACD;AACD;AACA,YAAI,KAAKpC,QAAT,EAAmB;AACjB,cAAIqC,cAAc,KAAKC,YAAL,CAAkB,KAAK1C,eAAL,CAAqBS,IAArB,CAA0BkC,MAA5C,CAAlB;AACA,cAAIF,gBAAgB,KAAKxC,gBAAzB,EAA2C;AACzCwC,0BAAc,KAAKC,YAAL,CAAkB,KAAK1C,eAAL,CAAqBS,IAArB,CAA0BkC,MAA5C,CAAd;AACD;AACD,eAAK1C,gBAAL,GAAwBwC,WAAxB;AACA,eAAKD,UAAL;AACA;AACD;AACD;AACA,YAAMI,WAAW,KAAK5C,eAAL,CAAqBS,IAArB,CAA0B,KAAKR,gBAAL,GAAwBqC,IAAlD,CAAjB;AACA,YAAI,CAACM,QAAL,EAAe;AACb,cAAIN,SAAS,CAAb,EAAgB;AACd,iBAAKrC,gBAAL,GAAwB,CAAxB;AACD,WAFD,MAEO;AACL,iBAAKA,gBAAL,GAAwB,KAAKD,eAAL,CAAqBS,IAArB,CAA0BkC,MAA1B,GAAiC,CAAzD;AACD;AACF,SAND,MAMO;AACL,eAAK1C,gBAAL,IAAyBqC,IAAzB;AACD;AACD,aAAKE,UAAL;AACD,OA7EM;AA8EPA,gBA9EO,wBA8EM;AACX;AACA,YAAI,KAAKnC,MAAT,EAAiB;AACf9B,iBAAOsE,aAAP,CAAqB;AACnB3D,qBAAS,KAAKc,eAAL,CAAqBS,IAArB,CAA0B,KAAKR,gBAA/B,EAAiD6C;AADvC,WAArB;AAGA,eAAKC,YAAL;AACD,SALD,MAKO;AACLxE,iBAAOyE,YAAP,CAAoB;AAClB9D,qBAAS,KAAKc,eAAL,CAAqBS,IAArB,CAA0B,KAAKR,gBAA/B,EAAiD6C;AADxC,WAApB;AAGD;AACF,OA1FM;AA2FPG,qBA3FO,2BA2FSC,OA3FT,EA2FkB;AACvB,aAAK7C,MAAL,GAAc6C,OAAd;AACA,aAAKC,SAAL;AACA,YAAI,KAAK9C,MAAT,EAAiB;AACf9B,iBAAO6E,SAAP;AACA,eAAKL,YAAL;AACD,SAHD,MAGO;AACLxE,iBAAO8E,UAAP;AACAC,wBAAc,KAAKnD,SAAnB;AACA,eAAKoD,UAAL;AACD;AACF,OAtGM;AAuGPb,kBAvGO,wBAuGMC,MAvGN,EAuGc;AACnB,eAAOa,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgBf,MAA3B,CAAP;AACD,OAzGM;AA0GPI,kBA1GO,0BA0GQ;AAAA;;AACb,aAAK5C,SAAL,GAAiBwD,YAAY,YAAM;AACjC,cAAI,CAAC,MAAKC,OAAV,EAAmB;AACjB,kBAAK1D,eAAL,GAAuBsD,KAAKC,KAAL,CAAWlF,OAAOsF,cAAP,EAAX,CAAvB;AACD;AACF,SAJgB,EAId,IAJc,CAAjB;AAKD,OAhHM;AAiHPC,eAjHO,uBAiHK;AAAA;;AACVzE,UAAE,MAAF,EAAU0E,GAAV,CAAc;AACZC,mBAAS;AADG,SAAd;AAGA,YAAI,KAAKlE,aAAL,KAAuB,KAAKF,GAAL,CAAS+C,MAApC,EAA2C;AACzC,eAAK7C,aAAL,GAAqB,CAArB;AACD;AACDT,UAAE,MAAF,EAAU4E,EAAV,CAAa,KAAKnE,aAAlB,EAAiCiE,GAAjC,CAAqC;AACnCC,mBAAS;AAD0B,SAArC;AAGA,aAAKlE,aAAL;AACAoE,mBAAW,YAAM;AACf,iBAAKJ,SAAL;AACD,SAFD,EAEG,IAFH;AAGD,OA/HM;AAgIPX,eAhIO,uBAgIK;AACV5E,eAAO4F,SAAP,CAAiB,KAAK7D,MAAL,GAAc,GAA/B;AACD,OAlIM;AAmIP8D,wBAnIO,gCAmIc;AACnB7F,eAAO8F,MAAP,CAAc,KAAKnE,eAAnB,EAAoC,IAApC;AACD,OArIM;AAsIPoE,eAtIO,uBAsIK;AACV,YAAMC,WAAWlF,EAAE,YAAF,EAAgBJ,KAAhB,KAAwB,CAAzC;AACAP,YAAI8F,SAAJ,GAAc,MAAd;AACA9F,YAAI+F,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB9F,EAAnB,EAAuBC,EAAvB;AACAF,YAAIgG,IAAJ;AACEhG,YAAIiG,SAAJ,CAAchG,KAAG,CAAjB,EAAoBC,KAAG,CAAvB;AACA,aAAI,IAAIgG,IAAE,CAAV,EAAYA,IAAE,CAAd,EAAgBA,GAAhB,EAAoB;AAClB,cAAMC,YAAY,KAAKnC,YAAL,CAAkB,CAAlB,IAAuB,CAAzC;AACAhE,cAAIoG,SAAJ;AACA,cAAIC,cAAcH,IAAEC,SAApB;AACA,cAAIG,YAAYJ,IAAE,GAAF,GAAMpB,KAAKyB,EAAL,GAAQJ,SAA9B;AACAnG,cAAIwG,GAAJ,CAAQ,CAAR,EAAW,CAAX,EAAcX,WAAWK,IAAE,CAAb,GAAe,EAA7B,EAAiCG,WAAjC,EAA8CC,SAA9C;AACAtG,cAAIyG,SAAJ,GAAgB,CAAhB;AACAzG,cAAI0G,WAAJ,oBAA+B,IAAKR,IAAE,CAAtC;AACAlG,cAAI2G,MAAJ;AACD;AACH3G,YAAI4G,OAAJ;AACD,OAvJM;AAwJP/B,gBAxJO,wBAwJM;AACX7E,YAAIgG,IAAJ;AACEhG,YAAI8F,SAAJ,GAAc,MAAd;AACA9F,YAAI+F,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB9F,EAAnB,EAAuBC,EAAvB;AACFF,YAAI4G,OAAJ;AACD;AA7JM,KAhCE;AA+LXC,aAAS;AACPC,gBADO,sBACIC,GADJ,EACS;AACd,YAAMC,SAAS,OAAOlC,KAAKC,KAAL,CAAWgC,MAAI,EAAf,CAAtB;AACA,YAAME,SAAS,OAAQF,MAAI,EAA3B;AACA,eAAUC,OAAOE,MAAP,CAAc,CAAC,CAAf,CAAV,SAA+BD,OAAOC,MAAP,CAAc,CAAC,CAAf,CAA/B;AACD;AALM,KA/LE;AAsMXC,WAtMW,qBAsMD;AAAA;;AACRxG,QAAEyG,OAAF,CAAU,uBAAV,EAAmC,UAACC,GAAD,EAAS;AAC1C,eAAKpG,QAAL,GAAgBoG,IAAIpG,QAApB;AACA,eAAKC,GAAL,GAAWmG,IAAInG,GAAf;AACA,eAAKG,QAAL,GAAgB,OAAKJ,QAAL,CAAc,OAAKE,mBAAnB,CAAhB;AACA,eAAKG,eAAL,GAAuB,OAAKD,QAA5B;AACD,OALD;AAMD,KA7MU;AA8MXiG,WA9MW,qBA8MD;AAAA;;AACR,WAAKlC,SAAL;AACArF,gBAAUY,EAAE,cAAF,CAAV;AACAX,YAAMD,QAAQ,CAAR,EAAWwH,UAAX,CAAsB,IAAtB,CAAN;AACAtH,WAAKF,QAAQ,CAAR,EAAWQ,KAAX,GAAmBI,EAAE,SAAF,EAAaJ,KAAb,EAAxB;AACAL,WAAKH,QAAQ,CAAR,EAAWO,MAAX,GAAoBK,EAAE,YAAF,EAAgBL,MAAhB,KAA2B,EAApD;AACAkH,aAAOC,gBAAP,CAAwB,QAAxB,EAAkC,YAAW;AAC3CxH,aAAKF,QAAQ,CAAR,EAAWQ,KAAX,GAAmBI,EAAE,SAAF,EAAaJ,KAAb,EAAxB;AACAL,aAAKH,QAAQ,CAAR,EAAWO,MAAX,GAAoBK,EAAE,YAAF,EAAgBL,MAAhB,KAA2B,EAApD;AACD,OAHD;AAIA2E,kBAAY,YAAM;AAChB,YAAI,OAAKtD,MAAT,EAAiB;AACf,iBAAKiE,SAAL;AACD;AACF,OAJD,EAIG,GAJH;AAKD;AA7NU,GAAR,CAAL;AA+ND,CAhOD","file":"mp3player.js","sourcesContent":["const tag = document.createElement('script');\ntag.src = \"https://www.youtube.com/iframe_api\";\nconst firstScriptTag = document.getElementsByTagName('script')[0];\nfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\nlet player = null;\nlet vm = null;\nlet $canvas, ctx, ww, hh;\n\nfunction onYouTubeIframeAPIReady() {\n  player = new YT.Player('js_player', {\n    height: '0',\n    width: '0',\n    videoId: 'lzkKzZmRZk8',\n    events: {\n      'onStateChange': vm.onPlayerStateChange\n    }\n  });\n}\n\n$(function() {\n  vm = new Vue({\n    el: '#app',\n    data: {\n      slideMenu: true,\n      showList: true,\n      playlist: [],\n      ads: [],\n      activePlaylistIndex: 0,\n      activeAdIndex: 0,\n      menuList: {},\n      currentPlaylist: {},\n      currentSongIndex: 0,\n      currentSongTime: 0,\n      songTimer: null,\n      isRandom: false,\n      isPlay: false,\n      volumn: 0.5,\n    },\n    computed: {\n      currentSong() {\n        if (this.currentPlaylist.list) {\n          return this.currentPlaylist.list[this.currentSongIndex];\n        }\n        return '';\n      },\n      currentSongTotalTime() {\n        if (this.currentPlaylist.list) {\n          return this.currentPlaylist.list[this.currentSongIndex].list_duration;\n        }\n        return '';\n      },\n    },\n    methods: {\n      toggleList(e) {\n        this.showList ? $(e.target).next().slideUp('fast')\n          : $(e.target).next().slideDown('fast');\n        this.showList = !this.showList;\n      },\n      showMenuList(cataType, payload) {\n        let tempArr = [];\n        switch(cataType) {\n          case 1:\n            this.activePlaylistIndex = payload;\n            this.menuList = this.playlist[payload];\n            break;\n          case 2:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list];\n            });\n            tempArr.sort((a,b) => {\n              const aa = a['artist_name'].toLowerCase().trim();\n              const bb = b['artist_name'].toLowerCase().trim();\n              return aa === bb ? 0 : aa < bb ? -1 : 1;\n            });\n            this.menuList = {\n              title: '歌手',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          case 3:\n            this.playlist.forEach(list => {\n              tempArr = [...tempArr, ...list.list.filter(l => l.favorite)];\n            });\n            this.menuList = {\n              title: '我的最愛',\n              list: tempArr,\n            };\n            this.activePlaylistIndex = null;\n            break;\n          default:\n            break;\n        }\n      },\n      onPlayerStateChange(e) {\n        if (e.data === YT.PlayerState.ENDED) {\n          this.playSong(1);\n        }\n      },\n      playSong(step, from) {\n        this.currentPlaylist = this.menuList;\n        // 從播放清單選取\n        if (from === 'list') {\n          this.currentSongIndex = step;\n          this.callPlayer();\n          return;\n        }\n        // 隨機播放清單歌曲\n        if (this.isRandom) {\n          let randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          if (randomIndex === this.currentSongIndex) {\n            randomIndex = this.getRandomNum(this.currentPlaylist.list.length);\n          }\n          this.currentSongIndex = randomIndex;\n          this.callPlayer();\n          return;\n        }\n        // 依照順序播放上下首\n        const tempSong = this.currentPlaylist.list[this.currentSongIndex + step];\n        if (!tempSong) {\n          if (step === 1) {\n            this.currentSongIndex = 0;\n          } else {\n            this.currentSongIndex = this.currentPlaylist.list.length-1;\n          }\n        } else {\n          this.currentSongIndex += step;\n        }\n        this.callPlayer();\n      },\n      callPlayer() {\n        // 讀取 youtube 音源\n        if (this.isPlay) {\n          player.loadVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n          this.setSongTimer();\n        } else {\n          player.cueVideoById({\n            videoId: this.currentPlaylist.list[this.currentSongIndex].id,\n          });\n        }\n      },\n      changeSongState(boolean) {\n        this.isPlay = boolean;\n        this.setVolumn();\n        if (this.isPlay) {\n          player.playVideo();\n          this.setSongTimer();\n        } else {\n          player.pauseVideo();\n          clearInterval(this.songTimer);\n          this.clearCdArc();\n        }\n      },\n      getRandomNum(length) {\n        return Math.floor(Math.random() * length);\n      },\n      setSongTimer() {\n        this.songTimer = setInterval(() => {\n          if (!this.isSlide) {\n            this.currentSongTime = Math.floor(player.getCurrentTime());\n          }\n        }, 1000);\n      },\n      switchAds() {\n        $('.ads').css({\n          display: 'none',\n        });\n        if (this.activeAdIndex === this.ads.length){\n          this.activeAdIndex = 0;\n        }\n        $('.ads').eq(this.activeAdIndex).css({\n          display: 'block',\n        })\n        this.activeAdIndex++;\n        setTimeout(() => {\n          this.switchAds();\n        }, 5000);\n      },\n      setVolumn() {\n        player.setVolume(this.volumn * 100);\n      },\n      setCurrentSongTime() {\n        player.seekTo(this.currentSongTime, true);\n      },\n      drawCdArc() {\n        const cdRadius = $('.player_cd').width()/2;\n        ctx.fillStyle=\"#fff\";\n        ctx.fillRect(0, 0, ww, hh);\n        ctx.save();\n          ctx.translate(ww/2, hh/2);\n          for(var i=0;i<3;i++){\n            const randomNum = this.getRandomNum(5) + 5;\n            ctx.beginPath();\n            let start_angle = i*randomNum;\n            let end_angle = i/0.5+Math.PI/randomNum;\n            ctx.arc(0, 0, cdRadius + i*8+10, start_angle, end_angle);\n            ctx.lineWidth = 3;\n            ctx.strokeStyle= `rgba(0,0,0,${1 - (i/3)})`;\n            ctx.stroke();\n          }\n        ctx.restore();\n      },\n      clearCdArc() {\n        ctx.save();\n          ctx.fillStyle=\"#fff\";\n          ctx.fillRect(0, 0, ww, hh);\n        ctx.restore();\n      },\n    },\n    filters: {\n      formatTime(val) {\n        const minute = '00' + Math.floor(val/60);\n        const second = '00' + (val%60);\n        return `${minute.substr(-2)}:${second.substr(-2)}`;\n      },\n    },\n    created() {\n      $.getJSON('./json/mp3player.json', (res) => {\n        this.playlist = res.playlist;\n        this.ads = res.ads;\n        this.menuList = this.playlist[this.activePlaylistIndex];\n        this.currentPlaylist = this.menuList;\n      });\n    },\n    mounted() {\n      this.switchAds();\n      $canvas = $('#js_cdCanvas');\n      ctx = $canvas[0].getContext('2d');\n      ww = $canvas[0].width = $('.player').width();\n      hh = $canvas[0].height = $('.player_cd').height() + 60;\n      window.addEventListener(\"resize\", function() {\n        ww = $canvas[0].width = $('.player').width();\n        hh = $canvas[0].height = $('.player_cd').height() + 60;\n      });\n      setInterval(() => {\n        if (this.isPlay) {\n          this.drawCdArc();\n        }\n      }, 500);\n    },\n  });\n});"]}