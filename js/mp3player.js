"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var player=null,vm=null,$canvas=void 0,ctx=void 0,ww=void 0,hh=void 0;function onYouTubeIframeAPIReady(){player=new YT.Player("js_player",{height:"0",width:"0",videoId:"lzkKzZmRZk8",events:{onStateChange:vm.onPlayerStateChange}})}$(function(){vm=new Vue({el:"#app",data:{slideMenu:!0,showList:!0,playlist:[],ads:[],activePlaylistIndex:0,activeAdIndex:0,menuList:{},currentPlaylist:{},currentSongIndex:0,currentSongTime:0,songTimer:null,isRandom:!1,isPlay:!1,volumn:.5},computed:{currentSong:function(){return this.currentPlaylist.list?this.currentPlaylist.list[this.currentSongIndex]:""},currentSongTotalTime:function(){return this.currentPlaylist.list?this.currentPlaylist.list[this.currentSongIndex].list_duration:""}},methods:{toggleList:function(t){this.showList?$(t.target).next().slideUp("fast"):$(t.target).next().slideDown("fast"),this.showList=!this.showList},showMenuList:function(t,e){var i=[];switch(t){case 1:this.activePlaylistIndex=e,this.menuList=this.playlist[e];break;case 2:this.playlist.forEach(function(t){i=[].concat(_toConsumableArray(i),_toConsumableArray(t.list))}),i.sort(function(t,e){var i=t.artist_name.toLowerCase().trim(),n=e.artist_name.toLowerCase().trim();return i===n?0:i<n?-1:1}),this.menuList={title:"歌手",list:i},this.activePlaylistIndex=null;break;case 3:this.playlist.forEach(function(t){i=[].concat(_toConsumableArray(i),_toConsumableArray(t.list.filter(function(t){return t.favorite})))}),this.menuList={title:"我的最愛",list:i},this.activePlaylistIndex=null}},onPlayerStateChange:function(t){t.data===YT.PlayerState.ENDED&&this.playSong(1)},playSong:function(t,e){if(this.currentPlaylist=this.menuList,"list"===e)return this.currentSongIndex=t,void this.callPlayer();if(this.isRandom){var i=this.getRandomNum(this.currentPlaylist.list.length);return i===this.currentSongIndex&&(i=this.getRandomNum(this.currentPlaylist.list.length)),this.currentSongIndex=i,void this.callPlayer()}this.currentPlaylist.list[this.currentSongIndex+t]?this.currentSongIndex+=t:this.currentSongIndex=1===t?0:this.currentPlaylist.list.length-1,this.callPlayer()},callPlayer:function(){this.isPlay?(player.loadVideoById({videoId:this.currentPlaylist.list[this.currentSongIndex].id}),this.setSongTimer()):player.cueVideoById({videoId:this.currentPlaylist.list[this.currentSongIndex].id})},changeSongState:function(t){this.isPlay=t,this.setVolumn(),this.isPlay?(player.playVideo(),this.setSongTimer()):(player.pauseVideo(),clearInterval(this.songTimer),this.clearCdArc())},getRandomNum:function(t){return Math.floor(Math.random()*t)},setSongTimer:function(){var t=this;this.songTimer=setInterval(function(){t.isSlide||(t.currentSongTime=Math.floor(player.getCurrentTime()))},1e3)},switchAds:function(){var t=this;$(".ads").css({display:"none"}),this.activeAdIndex===this.ads.length&&(this.activeAdIndex=0),$(".ads").eq(this.activeAdIndex).css({display:"block"}),this.activeAdIndex++,setTimeout(function(){t.switchAds()},5e3)},setVolumn:function(){player.setVolume(100*this.volumn)},setCurrentSongTime:function(){player.seekTo(this.currentSongTime,!0)},drawCdArc:function(){var t=$(".player_cd").width()/2;ctx.fillStyle="#fff",ctx.fillRect(0,0,ww,hh),ctx.save(),ctx.translate(ww/2,hh/2);for(var e=0;e<3;e++){var i=this.getRandomNum(5)+5;ctx.beginPath();var n=e*i,s=e/.5+Math.PI/i;ctx.arc(0,0,t+8*e+10,n,s),ctx.lineWidth=3,ctx.strokeStyle="rgba(0,0,0,"+(1-e/3)+")",ctx.stroke()}ctx.restore()},clearCdArc:function(){ctx.save(),ctx.fillStyle="#fff",ctx.fillRect(0,0,ww,hh),ctx.restore()}},filters:{formatTime:function(t){var e="00"+t%60;return("00"+Math.floor(t/60)).substr(-2)+":"+e.substr(-2)}},created:function(){var e=this;$.getJSON("./json/mp3player.json",function(t){e.playlist=t.playlist,e.ads=t.ads,e.menuList=e.playlist[e.activePlaylistIndex],e.currentPlaylist=e.menuList})},mounted:function(){var t=this;this.switchAds(),$canvas=$("#js_cdCanvas"),ctx=$canvas[0].getContext("2d"),ww=$canvas[0].width=$(".player").width(),hh=$canvas[0].height=$(".player_cd").height()+60,window.addEventListener("resize",function(){ww=$canvas[0].width=$(".player").width(),hh=$canvas[0].height=$(".player_cd").height()+60}),setInterval(function(){t.isPlay&&t.drawCdArc()},500)}})});
//# sourceMappingURL=mp3player.js.map
