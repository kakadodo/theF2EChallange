{"version":3,"sources":["filter.js"],"names":["$","API","vm","Vue","el","data","loading","listsData","pageData","filterInputData","LocName","City","District","AvailableTime","filterData","filterMode","pagination","currentPage","modalLocName","googleMap","map","marker","infowindow","filterOpen","computed","showPages","pageRange","min","Math","floor","max","ceil","length","filter","page","i","getCity","citys","list","JSON","parse","List","Value","city","arr","indexOf","getDistrict","inputCity","district","forEach","push","dist","methods","getAPIData","axios","get","then","response","combineDataByPages","catch","error","alert","dataCopy","stringify","pageCount","parseInt","splice","movePage","move","showMap","_this","pos","lat","Latitude","lng","Longitude","icon","address","Address","replace","content","google","maps","Map","document","getElementById","center","zoom","Marker","position","animation","Animation","DROP","InfoWindow","open","filterLists","tempData","key","toLowerCase","watch","val","debounce","oldVal","created","_","mounted"],"mappings":"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","file":"filter.js","sourcesContent":["$(function(){\r\n  let API = 'https://wapi.gogoro.com/tw/api/vm/list';\r\n\r\n  const vm = new Vue({\r\n    el:'#app',\r\n    data:{\r\n      loading: true,\r\n      listsData:[],\r\n      pageData:[],\r\n      filterInputData:{\r\n        LocName:'',\r\n        City:'',\r\n        District:'',\r\n        AvailableTime: false\r\n      },\r\n      filterData:[],\r\n      filterMode: false,\r\n      pagination:[],\r\n      currentPage:1,\r\n      modalLocName:'',\r\n      googleMap:{\r\n        map:{},\r\n        marker:{},\r\n        infowindow:{}\r\n      },\r\n      filterOpen:false\r\n    },\r\n    computed:{\r\n      showPages(){\r\n        //依 currentPage 決定當前的頁數範圍\r\n        let pageRange = {\r\n          min: this.currentPage % 10 == 0 ? (this.currentPage - 9) : (Math.floor(this.currentPage / 10) * 10 + 1),\r\n          max: this.currentPage % 10 == 0 ? this.currentPage : Math.ceil(this.currentPage / 10) * 10\r\n        };\r\n        // max 計算超過 pagination 總長度的話，max 就改為總長度\r\n        if(pageRange.max > this.pagination.length) pageRange.max = this.pagination.length;\r\n        return this.pagination.filter((page,i)=>{return page >= pageRange.min-1 && page <= pageRange.max-1});\r\n      },\r\n      getCity(){\r\n        const citys = this.listsData.map((list,i)=> JSON.parse(list.City).List[1].Value);\r\n        return citys.filter((city,i,arr)=> arr.indexOf(city) == i);\r\n      },\r\n      getDistrict(){\r\n        const inputCity = this.filterInputData.City;\r\n        if(inputCity==''){\r\n          return '';\r\n        }else{\r\n          const district = [];\r\n          this.listsData.forEach((list,i)=>{\r\n            if(JSON.parse(list.City).List[1].Value == inputCity){\r\n              district.push(JSON.parse(list.District).List[1].Value);\r\n            }else{\r\n              return;\r\n            }\r\n          });\r\n          return district.filter((dist,i,arr)=> arr.indexOf(dist) == i);\r\n        }\r\n      }\r\n    },\r\n    methods:{\r\n      getAPIData(){\r\n        axios.get(API)\r\n        .then(function (response) {\r\n          vm.listsData = response.data.data;\r\n          // console.log(vm.listsData);\r\n          vm.combineDataByPages();\r\n\r\n        })\r\n        .catch(function (error) {\r\n          alert('資料載入有誤，請稍後再試! error: '+ error);\r\n        });\r\n      },\r\n      combineDataByPages(){\r\n        //複製一份原始資料\r\n        const dataCopy = JSON.parse(JSON.stringify(vm.listsData));\r\n        //需要render的總頁數 31頁\r\n        const pageCount = dataCopy.length%20 == 0? (dataCopy.length/20) : parseInt(dataCopy.length/20)+1;\r\n        //重組成以頁數區分的資料，1頁20筆\r\n        for(let i=0; i<pageCount; i++){\r\n          this.pageData.push(dataCopy.splice(0,20));\r\n          vm.pagination.push(i);\r\n        }\r\n        this.loading = false;\r\n      },\r\n      movePage(move){\r\n        if(move == 'prev'){\r\n          this.currentPage--;\r\n        }else if(move == 'next'){\r\n          this.currentPage++;\r\n        }else{\r\n          this.currentPage = parseInt(move);\r\n        }\r\n      },\r\n      showMap(data){\r\n        this.modalLocName = JSON.parse(data.LocName).List[1].Value;\r\n        const _this = this;\r\n        const pos = {lat: data.Latitude, lng: data.Longitude};\r\n        const icon = 'https://raw.githubusercontent.com/kakadodo/theF2EChallange/gh-pages/img/week2/battery-icon.png';\r\n        const address = JSON.parse(data.Address).List[1].Value.replace(/\\(.+\\)/g,'');\r\n        const content = `\r\n          <div>\r\n            <h5>${JSON.parse(data.LocName).List[1].Value}</h5>\r\n            <p>\r\n              <a href='https://www.google.com/maps/place/${address}' target='_blank'>\r\n                ${JSON.parse(data.Address).List[1].Value}\r\n              </a>\r\n            </p>\r\n          </div>\r\n        `;\r\n        this.googleMap.map = new google.maps.Map(document.getElementById('map'), {\r\n          center: pos,\r\n          zoom: 15\r\n        });\r\n        this.googleMap.marker = new google.maps.Marker({\r\n          position: pos,\r\n          map: _this.googleMap.map,\r\n          icon: icon,\r\n          animation: google.maps.Animation.DROP,\r\n        });\r\n        this.googleMap.infowindow = new google.maps.InfoWindow({\r\n          content: content,\r\n        });\r\n        this.googleMap.infowindow.open(this.googleMap.map, this.googleMap.marker);\r\n      },\r\n      filterLists(){\r\n        //判斷是否為 filter mode\r\n        if(this.filterInputData.LocName == '' && this.filterInputData.City == '' && this.filterInputData.District == '' && this.filterInputData.AvailableTime == false){\r\n          this.filterMode = false;\r\n        }else{\r\n          this.filterMode = true;\r\n        }\r\n        let tempData = JSON.parse(JSON.stringify(this.listsData));\r\n        for(let key in this.filterInputData){\r\n          //檢查 LocName、City、District\r\n          if(this.filterInputData[key]!=='' && key !== 'AvailableTime'){\r\n            tempData = tempData.filter((list,i)=>{\r\n              if(key == 'LocName'){\r\n                return (JSON.parse(list[key]).List[1].Value).toLowerCase().indexOf((this.filterInputData[key]).toLowerCase())!== -1;\r\n              }else{\r\n                return JSON.parse(list[key]).List[1].Value == this.filterInputData[key];\r\n              }\r\n            });\r\n          }\r\n          //檢查 AvailableTime\r\n          if(key == 'AvailableTime' && this.filterInputData[key]){\r\n            tempData = tempData.filter((list,i)=>{\r\n              return list[key] == '24HR';\r\n            });\r\n          }\r\n        }\r\n        //將篩選後的結果篩回 filterData\r\n        this.filterData = tempData.filter((list,i)=>{\r\n          return true;\r\n        });\r\n      }\r\n    },\r\n    watch:{\r\n      'filterInputData.LocName':function(val){\r\n        this.debounce(val);\r\n      },\r\n      'filterInputData.City':function(val){\r\n        this.filterInputData.District = '';\r\n        vm.filterLists();\r\n      },\r\n      'filterInputData.AvailableTime':function(val,oldVal){\r\n        if(val !== oldVal) vm.filterLists();\r\n      }\r\n    },\r\n    created(){\r\n      //定義 underscore debounce 讓 vue 使用\r\n      this.debounce = _.debounce(this.filterLists,500);\r\n    },\r\n    mounted(){\r\n      this.getAPIData();\r\n    }\r\n  });\r\n});"]}