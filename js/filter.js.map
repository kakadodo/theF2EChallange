{"version":3,"sources":["filter.js"],"names":["$","API","vm","Vue","el","data","loading","listsData","pageData","filterInputData","LocName","City","District","AvailableTime","filterData","filterMode","pagination","currentPage","modalLocName","googleMap","map","marker","infowindow","filterOpen","computed","sliceNum","length","showPages","slice","getCity","citys","list","i","JSON","parse","List","Value","filter","city","arr","indexOf","getDistrict","inputCity","district","forEach","push","dist","methods","getAPIData","axios","get","then","response","combineDataByPages","catch","error","alert","dataCopy","stringify","pageCount","parseInt","splice","movePage","move","showMap","_this","pos","lat","Latitude","lng","Longitude","icon","address","Address","replace","content","google","maps","Map","document","getElementById","center","zoom","Marker","position","animation","Animation","DROP","InfoWindow","open","filterLists","tempData","key","toLowerCase","watch","val","debounce","oldVal","created","_","mounted"],"mappings":"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","file":"filter.js","sourcesContent":["$(function(){\r\n  //render map\r\n  // $('#googleMapModal').on('show.bs.modal', function (e) {\r\n  //   new google.maps.Map(document.getElementById('map'), {\r\n  //     center: {lat: -34.397, lng: 150.644},\r\n  //     zoom: 8\r\n  //   });\r\n  // });\r\n\r\n  let API = 'https://wapi.gogoro.com/tw/api/vm/list';\r\n\r\n  const vm = new Vue({\r\n    el:'#app',\r\n    data:{\r\n      loading: true,\r\n      listsData:[],\r\n      pageData:[],\r\n      filterInputData:{\r\n        LocName:'',\r\n        City:'',\r\n        District:'',\r\n        AvailableTime: false\r\n      },\r\n      filterData:[],\r\n      filterMode: false,\r\n      pagination:[],\r\n      currentPage:1,\r\n      modalLocName:'',\r\n      googleMap:{\r\n        map:{},\r\n        marker:{},\r\n        infowindow:{}\r\n      },\r\n      filterOpen:false\r\n    },\r\n    computed:{\r\n      sliceNum(){\r\n        //判斷頁數顯示的範圍\r\n        if(this.currentPage > this.pagination.length -10){\r\n          return this.pagination.length;\r\n        }else{\r\n          return 9 + this.currentPage;\r\n        }\r\n      },\r\n      showPages(){\r\n        //固定顯示10筆頁數\r\n        return this.currentPage+10 <= this.pagination.length? this.pagination.slice(this.currentPage-1, this.sliceNum) : this.pagination.slice(this.pagination.length-10, this.sliceNum);\r\n      },\r\n      getCity(){\r\n        const citys = this.listsData.map((list,i)=> JSON.parse(list.City).List[1].Value);\r\n        return citys.filter((city,i,arr)=> arr.indexOf(city) == i);\r\n      },\r\n      getDistrict(){\r\n        const inputCity = this.filterInputData.City;\r\n        if(inputCity==''){\r\n          return '';\r\n        }else{\r\n          const district = [];\r\n          this.listsData.forEach((list,i)=>{\r\n            if(JSON.parse(list.City).List[1].Value == inputCity){\r\n              district.push(JSON.parse(list.District).List[1].Value);\r\n            }else{\r\n              return;\r\n            }\r\n          });\r\n          return district.filter((dist,i,arr)=> arr.indexOf(dist) == i);\r\n        }\r\n      }\r\n    },\r\n    methods:{\r\n      getAPIData(){\r\n        axios.get(API)\r\n        .then(function (response) {\r\n          vm.listsData = response.data.data;\r\n          // console.log(vm.listsData);\r\n          vm.combineDataByPages();\r\n\r\n        })\r\n        .catch(function (error) {\r\n          alert('資料載入有誤，請稍後再試! error: '+ error);\r\n        });\r\n      },\r\n      combineDataByPages(){\r\n        //複製一份原始資料\r\n        const dataCopy = JSON.parse(JSON.stringify(vm.listsData));\r\n        //需要render的總頁數 31頁\r\n        const pageCount = dataCopy.length%20 == 0? (dataCopy.length/20) : parseInt(dataCopy.length/20)+1;\r\n        //重組成以頁數區分的資料，1頁20筆\r\n        for(let i=0; i<pageCount; i++){\r\n          this.pageData.push(dataCopy.splice(0,20));\r\n          vm.pagination.push(i);\r\n        }\r\n        this.loading = false;\r\n      },\r\n      movePage(move){\r\n        if(move == 'prev'){\r\n          this.currentPage--;\r\n        }else if(move == 'prev'){\r\n          this.currentPage++;\r\n        }else{\r\n          this.currentPage = parseInt(move);\r\n        }\r\n      },\r\n      showMap(data){\r\n        this.modalLocName = JSON.parse(data.LocName).List[1].Value;\r\n        const _this = this;\r\n        const pos = {lat: data.Latitude, lng: data.Longitude};\r\n        const icon = 'https://raw.githubusercontent.com/kakadodo/theF2EChallange/gh-pages/img/week2/battery-icon.png';\r\n        const address = JSON.parse(data.Address).List[1].Value.replace(/\\(.+\\)/g,'');\r\n        const content = `\r\n          <div>\r\n            <h5>${JSON.parse(data.LocName).List[1].Value}</h5>\r\n            <p>\r\n              <a href='https://www.google.com/maps/place/${address}' target='_blank'>\r\n                ${JSON.parse(data.Address).List[1].Value}\r\n              </a>\r\n            </p>\r\n          </div>\r\n        `;\r\n        this.googleMap.map = new google.maps.Map(document.getElementById('map'), {\r\n          center: pos,\r\n          zoom: 15\r\n        });\r\n        this.googleMap.marker = new google.maps.Marker({\r\n          position: pos,\r\n          map: _this.googleMap.map,\r\n          icon: icon,\r\n          animation: google.maps.Animation.DROP,\r\n        });\r\n        this.googleMap.infowindow = new google.maps.InfoWindow({\r\n          content: content,\r\n        });\r\n        this.googleMap.infowindow.open(this.googleMap.map, this.googleMap.marker);\r\n      },\r\n      filterLists(){\r\n        //判斷是否為 filter mode\r\n        if(this.filterInputData.LocName == '' && this.filterInputData.City == '' && this.filterInputData.District == '' && this.filterInputData.AvailableTime == false){\r\n          this.filterMode = false;\r\n        }else{\r\n          this.filterMode = true;\r\n        }\r\n        let tempData = JSON.parse(JSON.stringify(this.listsData));\r\n        for(let key in this.filterInputData){\r\n          //檢查 LocName、City、District\r\n          if(this.filterInputData[key]!=='' && key !== 'AvailableTime'){\r\n            tempData = tempData.filter((list,i)=>{\r\n              if(key == 'LocName'){\r\n                return (JSON.parse(list[key]).List[1].Value).toLowerCase().indexOf((this.filterInputData[key]).toLowerCase())!== -1;\r\n              }else{\r\n                return JSON.parse(list[key]).List[1].Value == this.filterInputData[key];\r\n              }\r\n            });\r\n          }\r\n          //檢查 AvailableTime\r\n          if(key == 'AvailableTime' && this.filterInputData[key]){\r\n            tempData = tempData.filter((list,i)=>{\r\n              return list[key] == '24HR';\r\n            });\r\n          }\r\n        }\r\n        //將篩選後的結果篩回 filterData\r\n        this.filterData = tempData.filter((list,i)=>{\r\n          return true;\r\n        });\r\n      }\r\n    },\r\n    watch:{\r\n      'filterInputData.LocName':function(val){\r\n        this.debounce(val);\r\n      },\r\n      'filterInputData.City':function(val){\r\n        this.filterInputData.District = '';\r\n        vm.filterLists();\r\n      },\r\n      'filterInputData.AvailableTime':function(val,oldVal){\r\n        if(val !== oldVal) vm.filterLists();\r\n      }\r\n    },\r\n    created(){\r\n      //定義 underscore debounce 讓 vue 使用\r\n      this.debounce = _.debounce(this.filterLists,500);\r\n    },\r\n    mounted(){\r\n      this.getAPIData();\r\n    }\r\n  });\r\n});"]}