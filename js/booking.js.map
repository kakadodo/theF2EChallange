{"version":3,"sources":["booking.js"],"names":["vm","window","onload","Vue","el","data","axios","roomsInfo","roomDetail","bookingStep","roomDetailisLoading","submitLoading","pickerOptions","disabledDate","time","booking","isDisabled","forEach","getFullYear","Date","date","getMonth","getDate","getTime","formBooking","name","tel","email","formDate","formDateSeparate","formBookingRule","required","message","trigger","type","submitDialogVisible","computed","bookingTotalDays","start","end","days","bookingTotalDates","dates","i","dayTime","newDay","year","month","toString","padStart","push","bookingTotalPrice","room","normalDayPrice","methods","scrollToRooms","scrollToElement","roomsTitleOffset","document","querySelector","getBoundingClientRect","top","offsetHeight","scrollY","currentScroll","scrollSpeed","scrollTimer","setInterval","scrollTo","clearInterval","formatToFormDate","$message","error","tempArr","slice","sort","a","b","aa","bb","checkIfSameDate","showRoomDetail","roomId","get","then","res","success","setTimeout","showSubmitDialog","submitBooking","$refs","validate","valid","bodyFormData","FormData","append","post","id","headers","resetForm","resetFields","resetAllData","fixScrollDisappear","body","style","overflow","watch","val","created","create","baseURL","timeout","Acctept","Authorization","items"],"mappings":"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","file":"booking.js","sourcesContent":["let vm = null;\r\n\r\nwindow.onload = () => {\r\n  vm = new Vue({\r\n    el: '#app',\r\n    data() {\r\n      return {\r\n        axios: null,\r\n        roomsInfo: [],\r\n        roomDetail: [],\r\n        bookingStep: 1,\r\n        roomDetailisLoading: true,\r\n        submitLoading: false,\r\n        pickerOptions: {\r\n          disabledDate(time) {\r\n            const booking = vm.roomDetail.booking;\r\n            let isDisabled = false;\r\n            booking.forEach(date => {\r\n              if (\r\n                time.getFullYear() == new Date(date.date).getFullYear() &&\r\n                time.getMonth() == new Date(date.date).getMonth() &&\r\n                time.getDate() == new Date(date.date).getDate()\r\n              ) {\r\n                isDisabled = true;\r\n              }\r\n            });\r\n            return isDisabled\r\n              ? isDisabled\r\n              : time.getTime() < new Date().getTime() ||\r\n                  time.getTime() >\r\n                    new Date().getTime() + 1000 * 60 * 60 * 24 * 92;\r\n          },\r\n        },\r\n        formBooking: {\r\n          name: '',\r\n          tel: '',\r\n          email: '',\r\n        },\r\n        formDate: null,\r\n        formDateSeparate: [null, null],\r\n        formBookingRule: {\r\n          name: [{ required: true, message: '請輸入姓名', trigger: 'blur' }],\r\n          tel: [{ required: true, message: '請輸入聯絡電話', trigger: 'blur' }],\r\n          email: [\r\n            { required: true, message: '請輸入 email', trigger: 'blur' },\r\n            {\r\n              type: 'email',\r\n              message: '請輸入正確的 email 格式',\r\n              trigger: ['blur', 'change'],\r\n            },\r\n          ],\r\n        },\r\n        submitDialogVisible: false,\r\n      };\r\n    },\r\n    computed: {\r\n      bookingTotalDays() {\r\n        const start = new Date(this.formDate[0]).getTime();\r\n        const end = new Date(this.formDate[1]).getTime();\r\n        const days = (end - start) / 1000 / 60 / 60 / 24;\r\n        return days;\r\n      },\r\n      bookingTotalDates() {\r\n        const start = new Date(this.formDate[0]).getTime();\r\n        let dates = [this.formDate[0]];\r\n        for (let i = 1; i <= this.bookingTotalDays; i++) {\r\n          const dayTime = 1000 * 60 * 60 * 24;\r\n          let newDay = new Date(start + dayTime * i);\r\n          const year = newDay.getFullYear();\r\n          const month = (newDay.getMonth() + 1).toString().padStart(2, 0);\r\n          const date = newDay\r\n            .getDate()\r\n            .toString()\r\n            .padStart(2, 0);\r\n          dates.push(`${year}-${month}-${date}`);\r\n        }\r\n        return dates;\r\n      },\r\n      bookingTotalPrice() {\r\n        return this.formDate\r\n          ? this.roomDetail.room[0].normalDayPrice * this.bookingTotalDays\r\n          : 0;\r\n      },\r\n    },\r\n    methods: {\r\n      scrollToRooms() {\r\n        this.bookingStep = 1;\r\n        this.scrollToElement('.title');\r\n      },\r\n      scrollToElement(el) {\r\n        const roomsTitleOffset =\r\n          document.querySelector(`${el}`).getBoundingClientRect().top -\r\n          document.querySelector('.title').offsetHeight * 2;\r\n        let scrollY = window.scrollY;\r\n        let currentScroll = scrollY;\r\n        let scrollSpeed = 5;\r\n        let scrollTimer = null;\r\n        if (roomsTitleOffset > 0) {\r\n          scrollTimer = setInterval(() => {\r\n            if (currentScroll < roomsTitleOffset + scrollY) {\r\n              window.scrollTo(0, currentScroll);\r\n              currentScroll += scrollSpeed;\r\n            } else {\r\n              clearInterval(scrollTimer);\r\n            }\r\n          }, 0);\r\n        } else {\r\n          scrollTimer = setInterval(() => {\r\n            if (currentScroll > roomsTitleOffset + scrollY) {\r\n              window.scrollTo(0, currentScroll - scrollSpeed);\r\n              currentScroll -= scrollSpeed;\r\n            } else {\r\n              clearInterval(scrollTimer);\r\n            }\r\n          }, 0);\r\n        }\r\n      },\r\n      formatToFormDate() {\r\n        // 將小螢幕的 datePick 值轉換到 formDate\r\n        // 如果開始與結束日沒有輸入完全就直接跳過\r\n        if (!this.formDateSeparate[0] || !this.formDateSeparate[0]) return;\r\n        if (this.formDateSeparate[0] === this.formDateSeparate[1]) {\r\n          this.$message.error('開始及結束日期不能相同');\r\n          this.formDateSeparate = [null, null];\r\n          return;\r\n        }\r\n        // 如果兩個都有輸入就轉換，轉換會把日期順序重新排列\r\n        if (this.formDateSeparate[0] && this.formDateSeparate[1]) {\r\n          let tempArr = this.formDateSeparate.slice().sort((a, b) => {\r\n            const aa = new Date(a).getTime();\r\n            const bb = new Date(b).getTime();\r\n            return aa - bb;\r\n          });\r\n          this.formDateSeparate = tempArr;\r\n          this.formDate = tempArr;\r\n        }\r\n      },\r\n      checkIfSameDate() {\r\n        if (this.formDate[0] === this.formDate[1]) {\r\n          this.$message.error('開始及結束日期不能相同');\r\n          this.formDate = null;\r\n          return;\r\n        }\r\n        this.formDateSeparate = [...this.formDate];\r\n      },\r\n      showRoomDetail(roomId) {\r\n        this.bookingStep = 2;\r\n        this.roomDetailisLoading = true;\r\n        this.axios.get(`/room/${roomId}`).then(res => {\r\n          if (res.data.success) {\r\n            this.roomDetail = res.data;\r\n            this.roomDetailisLoading = false;\r\n            setTimeout(() => {\r\n              this.scrollToElement('.title');\r\n            }, 500);\r\n          }\r\n        });\r\n      },\r\n      showSubmitDialog() {\r\n        if (!this.formDate) {\r\n          this.$message.error('請選擇開始及結束日期');\r\n        } else {\r\n          this.submitDialogVisible = true;\r\n        }\r\n      },\r\n      submitBooking() {\r\n        this.$refs.formBooking.validate(valid => {\r\n          if (valid) {\r\n            this.submitLoading = true;\r\n            const bodyFormData = new FormData();\r\n            bodyFormData.append('name', this.formBooking.name);\r\n            bodyFormData.append('tel', this.formBooking.tel);\r\n            this.bookingTotalDates.forEach((date, i) => {\r\n              bodyFormData.append(`date[${i}]`, date);\r\n            });\r\n            this.axios\r\n              .post(`/room/${this.roomDetail.room[0].id}`, bodyFormData, {\r\n                headers: { 'Content-Type': 'multipart/form-data' },\r\n              })\r\n              .then(res => {\r\n                if (res.data.success) {\r\n                  this.bookingStep = 3;\r\n                  this.submitDialogVisible = false;\r\n                }\r\n              });\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      resetForm() {\r\n        this.submitDialogVisible = false;\r\n        this.$refs.formBooking.resetFields();\r\n      },\r\n      resetAllData() {\r\n        this.formDate = null;\r\n        this.formBooking = {\r\n          name: '',\r\n          tel: '',\r\n          email: '',\r\n        };\r\n        this.formDateSeparate = [null, null];\r\n      },\r\n      fixScrollDisappear() {\r\n        document.body.style.overflow = 'initial';\r\n      },\r\n    },\r\n    watch: {\r\n      bookingStep(val) {\r\n        if (val === 2) {\r\n          this.resetAllData();\r\n        }\r\n      },\r\n    },\r\n    created() {\r\n      this.axios = axios.create({\r\n        baseURL: 'https://challenge.thef2e.com/api/thef2e2019/stage6',\r\n        timeout: 5000,\r\n        headers: {\r\n          Acctept: 'application/json',\r\n          Authorization:\r\n            'Bearer euQEgajjI9dbwkiVreUIsLvRDdKbqDQKAhnj678BLygJKajkPchRzS9COCc',\r\n        },\r\n      });\r\n      this.axios.get('/rooms').then(res => {\r\n        if (res.data.success) {\r\n          this.roomsInfo = res.data.items;\r\n        }\r\n      });\r\n    },\r\n  });\r\n};\r\n"]}