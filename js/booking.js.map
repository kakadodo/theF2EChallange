{"version":3,"sources":["booking.js"],"names":["vm","window","onload","Vue","el","data","axios","roomsInfo","roomDetail","bookingStep","roomDetailisLoading","submitLoading","pickerOptions","disabledDate","time","booking","isDisabled","forEach","getFullYear","Date","date","getMonth","getDate","getTime","formBooking","name","tel","email","formDate","formDateSeparate","formBookingRule","required","message","trigger","type","submitDialogVisible","computed","bookingTotalDays","start","end","days","bookingTotalDates","dates","i","dayTime","newDay","year","month","toString","padStart","push","bookingTotalPrice","room","normalDayPrice","methods","scrollToRooms","scrollToElement","roomsTitleOffset","document","querySelector","getBoundingClientRect","top","offsetHeight","scrollY","currentScroll","scrollSpeed","scrollTimer","setInterval","scrollTo","clearInterval","showRoomDetail","roomId","get","then","res","success","setTimeout","showSubmitDialog","tempArr","slice","sort","a","b","aa","bb","$message","error","submitBooking","$refs","validate","valid","bodyFormData","FormData","append","post","id","headers","resetForm","resetFields","resetAllData","watch","val","created","create","baseURL","timeout","Acctept","Authorization","items"],"mappings":"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","file":"booking.js","sourcesContent":["let vm = null;\r\n\r\nwindow.onload = () => {\r\n  vm = new Vue({\r\n    el: \"#app\",\r\n    data() {\r\n      return {\r\n        axios: null,\r\n        roomsInfo: [],\r\n        roomDetail: [],\r\n        bookingStep: 1,\r\n        roomDetailisLoading: true,\r\n        submitLoading: false,\r\n        pickerOptions: {\r\n          disabledDate(time) {\r\n            const booking = vm.roomDetail.booking;\r\n            let isDisabled = false;\r\n            booking.forEach(date => {\r\n              if (time.getFullYear() == new Date(date.date).getFullYear()\r\n                && time.getMonth() == new Date(date.date).getMonth()\r\n                && time.getDate() == new Date(date.date).getDate()) {\r\n                isDisabled = true;\r\n              }\r\n            });\r\n            return isDisabled ? isDisabled : (time.getTime() < new Date().getTime() || time.getTime() > (new Date().getTime() + 1000 * 60 * 60 * 24 * 92));\r\n          },\r\n        },\r\n        formBooking: {\r\n          name: '',\r\n          tel: '',\r\n          email: '',\r\n        },\r\n        formDate: null,\r\n        formDateSeparate: [null, null],\r\n        formBookingRule: {\r\n          name: [\r\n            { required: true, message: '請輸入姓名', trigger: 'blur' }\r\n          ],\r\n          tel: [\r\n            { required: true, message: '請輸入聯絡電話', trigger: 'blur' },\r\n          ],\r\n          email: [\r\n            { required: true, message: '請輸入 email', trigger: 'blur' },\r\n            { type: 'email', message: '請輸入正確的 email 格式', trigger: ['blur', 'change'] }\r\n          ]\r\n        },\r\n        submitDialogVisible: false,\r\n      }\r\n    },\r\n    computed: {\r\n      bookingTotalDays() {\r\n        const start = new Date(this.formDate[0]).getTime();\r\n        const end = new Date(this.formDate[1]).getTime();\r\n        const days = (end - start) / 1000 / 60 / 60 / 24;\r\n        return days;\r\n      },\r\n      bookingTotalDates() {\r\n        const start = new Date(this.formDate[0]).getTime();\r\n        let dates = [this.formDate[0]];\r\n        for (let i = 1; i <= this.bookingTotalDays; i++) {\r\n          const dayTime = 1000 * 60 * 60 * 24;\r\n          let newDay = new Date(start + (dayTime * i));\r\n          const year = newDay.getFullYear();\r\n          const month = (newDay.getMonth() + 1).toString().padStart(2, 0);\r\n          const date = (newDay.getDate()).toString().padStart(2, 0);\r\n          dates.push(`${year}-${month}-${date}`);\r\n        }\r\n        return dates;\r\n      },\r\n      bookingTotalPrice() {\r\n        return this.roomDetail.room[0].normalDayPrice * this.bookingTotalDays;\r\n      }\r\n    },\r\n    methods: {\r\n      scrollToRooms() {\r\n        this.bookingStep = 1;\r\n        this.scrollToElement('.title');\r\n      },\r\n      scrollToElement(el) {\r\n        const roomsTitleOffset = document.querySelector(`${el}`).getBoundingClientRect().top - document.querySelector('.title').offsetHeight * 2;\r\n        let scrollY = window.scrollY;\r\n        let currentScroll = scrollY;\r\n        let scrollSpeed = 5;\r\n        let scrollTimer = null;\r\n        if (roomsTitleOffset > 0) {\r\n          scrollTimer = setInterval(() => {\r\n            if (currentScroll < roomsTitleOffset + scrollY) {\r\n              window.scrollTo(0, currentScroll);\r\n              currentScroll += scrollSpeed;\r\n            } else {\r\n              clearInterval(scrollTimer);\r\n            }\r\n          }, 0);\r\n        } else {\r\n          scrollTimer = setInterval(() => {\r\n            if (currentScroll > roomsTitleOffset + scrollY) {\r\n              window.scrollTo(0, currentScroll - scrollSpeed);\r\n              currentScroll -= scrollSpeed;\r\n            } else {\r\n              clearInterval(scrollTimer);\r\n            }\r\n          }, 0);\r\n        }\r\n      },\r\n      showRoomDetail(roomId) {\r\n        this.bookingStep = 2;\r\n        this.roomDetailisLoading = true;\r\n        this.axios.get(`/room/${roomId}`).then((res) => {\r\n          if (res.data.success) {\r\n            this.roomDetail = res.data;\r\n            this.roomDetailisLoading = false;\r\n            setTimeout(() => {\r\n              this.scrollToElement('.title');\r\n            }, 500);\r\n          }\r\n        });\r\n      },\r\n      showSubmitDialog() {\r\n        // 小螢幕的 datePicker 判斷前先 format 日期\r\n        if (this.formDateSeparate[0] && this.formDateSeparate[1]) {\r\n          let tempArr = this.formDateSeparate.slice().sort((a, b) => {\r\n            const aa = new Date(a).getTime();\r\n            const bb = new Date(b).getTime();\r\n            return aa - bb;\r\n          });\r\n          this.formDateSeparate = tempArr;\r\n          this.formDate = tempArr;\r\n        }\r\n        if (!this.formDate) {\r\n          this.$message.error('請選擇開始及結束日期');\r\n        } else {\r\n          this.submitDialogVisible = true;\r\n        }\r\n      },\r\n      submitBooking() {\r\n        this.$refs.formBooking.validate((valid) => {\r\n          if (valid) {\r\n            this.submitLoading = true;\r\n            const bodyFormData = new FormData();\r\n            bodyFormData.append('name', this.formBooking.name);\r\n            bodyFormData.append('tel', this.formBooking.tel);\r\n            this.bookingTotalDates.forEach((date, i) => {\r\n              bodyFormData.append(`date[${i}]`, date);\r\n            });\r\n            this.axios.post(`/room/${this.roomDetail.room[0].id}`, bodyFormData, {\r\n              headers: { 'Content-Type': 'multipart/form-data' }\r\n            }).then((res) => {\r\n              if (res.data.success) {\r\n                this.bookingStep = 3;\r\n                this.submitDialogVisible = false;\r\n              }\r\n            });\r\n          } else {\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      resetForm() {\r\n        this.submitDialogVisible = false;\r\n        this.$refs.formBooking.resetFields();\r\n      },\r\n      resetAllData() {\r\n        this.formDate = null;\r\n        this.formBooking = {\r\n          name: '',\r\n          tel: '',\r\n          email: '',\r\n        };\r\n        this.formDateSeparate = [null, null];\r\n      }\r\n    },\r\n    watch: {\r\n      bookingStep(val) {\r\n        if (val === 2) {\r\n          this.resetAllData();\r\n        }\r\n      }\r\n    },\r\n    created() {\r\n      this.axios = axios.create({\r\n        baseURL: 'https://challenge.thef2e.com/api/thef2e2019/stage6',\r\n        timeout: 5000,\r\n        headers: {\r\n          Acctept: 'application/json',\r\n          Authorization: 'Bearer euQEgajjI9dbwkiVreUIsLvRDdKbqDQKAhnj678BLygJKajkPchRzS9COCc',\r\n        }\r\n      });\r\n      this.axios.get('/rooms').then((res) => {\r\n        if (res.data.success) {\r\n          this.roomsInfo = res.data.items;\r\n        }\r\n      });\r\n    },\r\n  });\r\n}\r\n\r\n"]}